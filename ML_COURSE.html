<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>ML_COURSE</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}


</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><p><span>《Introduction to Machine Learning with Python》《Python机器学习基础教程》</span></p><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3"><a class="md-toc-inner" href="#supervised-learning">Supervised Learning</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" href="#unsupervised-learning">Unsupervised Learning</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n5"><a class="md-toc-inner" href="#python-libspackages">Python Libs(Packages)</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n6"><a class="md-toc-inner" href="#scikit-learn">scikit-learn</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20"><a class="md-toc-inner" href="#depends-on-numpy-and-scipy">depends on NumPy and SciPy</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n21"><a class="md-toc-inner" href="#numpykey-point">Numpy(key point)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n22"><a class="md-toc-inner" href="#scipy">Scipy</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n23"><a class="md-toc-inner" href="#matplotlibkey-point">matplotlib(key point)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n24"><a class="md-toc-inner" href="#pandas">pandas</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n25"><a class="md-toc-inner" href="#mglearn-本书github代码httpsgithubcomamuellerintroductiontomlwithpython">mglearn 本书github代码</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n26"><a class="md-toc-inner" href="#chapter2-supervised-learning-监督学习">Chapter2 Supervised Learning 监督学习</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n27"><a class="md-toc-inner" href="#21-分类classifification）和回归regression）">2.1 分类（classifification）和回归（regression）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n28"><a class="md-toc-inner" href="#分类">#分类</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n39"><a class="md-toc-inner" href="#回归">#回归</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n52"><a class="md-toc-inner" href="#区分分类和回归">#区分分类和回归</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n56"><a class="md-toc-inner" href="#22-泛化过拟合与欠拟合">2.2 泛化、过拟合与欠拟合</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n73"><a class="md-toc-inner" href="#模型复杂度与数据集大小的关系">模型复杂度与数据集大小的关系</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n77"><a class="md-toc-inner" href="#23监督学习算法">2.3监督学习算法</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n78"><a class="md-toc-inner" href="#231-一些样本数据集">2.3.1 一些样本数据集</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n101"><a class="md-toc-inner" href="#232-k近邻-k-nearest-neighbor">2.3.2 k近邻 k-Nearest Neighbor</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n144"><a class="md-toc-inner" href="#233--线性模型-linear-models">2.3.3  线性模型 Linear models</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n224"><a class="md-toc-inner" href="#234-朴素贝叶斯分类器-naive-bayes-classifiers">2.3.4 朴素贝叶斯分类器 Naive Bayes Classifiers</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n256"><a class="md-toc-inner" href="#235-决策树-decision-trees">2.3.5 决策树 Decision trees</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n322"><a class="md-toc-inner" href="#236-决策树集成-ensembles-of-decision-trees">2.3.6 决策树集成 Ensembles of Decision Trees</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n325"><a class="md-toc-inner" href="#1随机森林-random-forest">1.随机森林 random forest </a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n404"><a class="md-toc-inner" href="#2梯度提升回归树梯度提升机）-gradient-boosted-regression-tree-gradient-boosting-machines">2.梯度提升回归树（梯度提升机） gradient boosted regression tree (gradient boosting machines)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n452"><a class="md-toc-inner" href="#237-核支持向量机-kernelized-support-vector-machines-svm）">2.3.7 核支持向量机 Kernelized Support Vector Machines （SVM）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n525"><a class="md-toc-inner" href="#238-神经网络深度学习）neural-networks-deep-learning">2.3.8 神经网络（深度学习）Neural Networks (Deep Learning)</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n527"><a class="md-toc-inner" href="#1神经网络模型">1.神经网络模型</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n557"><a class="md-toc-inner" href="#2神经网络调参">2.神经网络调参</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n610"><a class="md-toc-inner" href="#3优点缺点和参数">3.优点、缺点和参数</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n632"><a class="md-toc-inner" href="#24-分类器的不确定度估计-uncertainty-estimates-from-classifiers">2.4 分类器的不确定度估计 Uncertainty Estimates from Classifiers</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n638"><a class="md-toc-inner" href="#241-决策函数-decision-function">2.4.1 决策函数 Decision Function</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n639"><a class="md-toc-inner" href="#242-预测概率-predicting-probabilities">2.4.2 预测概率 Predicting Probabilities</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n646"><a class="md-toc-inner" href="#243-多分类问题的不确定度-uncertainty-in-multiclass-classification">2.4.3 多分类问题的不确定度 Uncertainty in Multiclass Classification</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n652"><a class="md-toc-inner" href="#25-小结与展望-summary-and-outlook">2.5 小结与展望 Summary and Outlook</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n654"><a class="md-toc-inner" href="#快速总结-由简单到复杂的模型）">快速总结 （由简单到复杂的模型）</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n655"><a class="md-toc-inner" href="#1-最近邻-nearest-neighbors">#1 最近邻 Nearest neighbors</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n657"><a class="md-toc-inner" href="#2-线性模型-linear-models">#2 线性模型 Linear models</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n659"><a class="md-toc-inner" href="#3-朴素贝叶斯-naive-bayes">#3 朴素贝叶斯 Naive Bayes</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n662"><a class="md-toc-inner" href="#4-决策树-decision-trees">#4 决策树 Decision trees</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n664"><a class="md-toc-inner" href="#5-随机森林-random-forests">#5 随机森林 Random forests</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n667"><a class="md-toc-inner" href="#6-梯度提升决策树-gradient-boosted-decision-trees">#6 梯度提升决策树 Gradient boosted decision trees</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n670"><a class="md-toc-inner" href="#7-支持向量机-support-vector-machines">#7 支持向量机 Support vector machines</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n672"><a class="md-toc-inner" href="#8-神经网络-neural-networks">#8 神经网络 Neural networks</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n675"><a class="md-toc-inner" href="#chapter3-unsupervised-learning-and-preprocessing-无监督学习与预处理">Chapter3 Unsupervised Learning and Preprocessing 无监督学习与预处理</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n676"><a class="md-toc-inner" href="#31-无监督学习的类型-types-of-unsupervised-learning">3.1 无监督学习的类型 Types of unsupervised learning</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n691"><a class="md-toc-inner" href="#32-无监督学习的挑战-challenges-in-unsupervised-learning">3.2 无监督学习的挑战 Challenges in unsupervised learning</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n701"><a class="md-toc-inner" href="#33-预处理与缩放-preprocessing-and-scaling">3.3 预处理与缩放 Preprocessing and Scaling</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n702"><a class="md-toc-inner" href="#331-不同类型的预处理-diferent-kinds-of-preprocessing">3.3.1 不同类型的预处理 Diferent kinds of preprocessing</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n716"><a class="md-toc-inner" href="#332-应用数据变换-applying-data-transformations">3.3.2 应用数据变换 Applying data transformations</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n727"><a class="md-toc-inner" href="#333-对训练数据和测试数据进行相同的缩放-scaling-training-and-test-data-the-same-way">3.3.3 对训练数据和测试数据进行相同的缩放 Scaling training and test data the same way</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n732"><a class="md-toc-inner" href="#334-预处理对监督学习的作用-the-efect-of-preprocessing-on-supervised-learning">3.3.4 预处理对监督学习的作用 The efect of preprocessing on supervised learning</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n746"><a class="md-toc-inner" href="#34降维特征提取与流形学习-dimensionality-reduction-feature-extraction-and-manifold-learning">3.4　降维、特征提取与流形学习 Dimensionality Reduction, Feature Extraction and Manifold Learning </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n748"><a class="md-toc-inner" href="#341主成分分析-principal-component-analysis-pca">3.4.1　主成分分析 Principal Component Analysis (PCA)</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n778"><a class="md-toc-inner" href="#1将pca应用于cancer数据集并可视化">1.将PCA应用于cancer数据集并可视化</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n816"><a class="md-toc-inner" href="#2特征提取的特征脸-eigenfaces-for-feature-extraction">2.特征提取的特征脸 Eigenfaces for feature extraction</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n846"><a class="md-toc-inner" href="#342非负矩阵分解-non-negative-matrix-factorization-nmf">3.4.2　非负矩阵分解 Non-Negative Matrix Factorization (NMF)</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n858"><a class="md-toc-inner" href="#1将nmf应用于模拟数据">1.将NMF应用于模拟数据</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n877"><a class="md-toc-inner" href="#2将nmf应用于人脸图像">2.将NMF应用于人脸图像</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n905"><a class="md-toc-inner" href="#343用t-sne进行流形学习--manifold-learning-with-t-sne">3.4.3　用t-SNE进行流形学习  Manifold learning with t-SNE</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n939"><a class="md-toc-inner" href="#35--聚类-clustering">3.5  聚类 Clustering</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n941"><a class="md-toc-inner" href="#351-k均值聚类-k-means-clustering">3.5.1 k均值聚类 k-Means clustering </a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n958"><a class="md-toc-inner" href="#1k均值的失败案例">1.k均值的失败案例</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n967"><a class="md-toc-inner" href="#2矢量量化或者将k均值看作分解">2.矢量量化，或者将k均值看作分解</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1001"><a class="md-toc-inner" href="#352-凝聚聚类-agglomerative-clustering">3.5.2 凝聚聚类 Agglomerative Clustering </a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n1030"><a class="md-toc-inner" href="#1层次聚类与树状图-hierarchical-clustering-and-dendrograms">1.层次聚类与树状图 Hierarchical clustering and dendrograms</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1052"><a class="md-toc-inner" href="#353-dbscan-density-based-spatial-clustering-of-applications-with-noise">3.5.3 DBSCAN density-based spatial clustering of applications with noise</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1103"><a class="md-toc-inner" href="#354-聚类算法的对比与评估">3.5.4 聚类算法的对比与评估</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n1104"><a class="md-toc-inner" href="#1用真实值评估聚类-evaluating-clustering-with-ground-truth">1.用真实值评估聚类 Evaluating clustering with ground truth</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n1115"><a class="md-toc-inner" href="#2在没有真实值的情况下评估聚类-evaluating-clustering-without-ground-truth">2.在没有真实值的情况下评估聚类 Evaluating clustering without ground truth</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1125"><a class="md-toc-inner" href="#355-聚类方法小结--summary-of-clustering-methods">3.5.5 聚类方法小结  Summary of Clustering Methods</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1127"><a class="md-toc-inner" href="#估计器接口小结">估计器接口小结</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1130"><a class="md-toc-inner" href="#test1-课堂练习">Test1 课堂练习</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1133"><a class="md-toc-inner" href="#test2-课堂练习">Test2 课堂练习</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1136"><a class="md-toc-inner" href="#test3-课堂练习">Test3 课堂练习</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1139"><a class="md-toc-inner" href="#chapter4-representing-data-and-engineering-features-数据表示和特征工程">Chapter4 Representing Data and Engineering Features 数据表示和特征工程 </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1150"><a class="md-toc-inner" href="#411-one-hot编码虚拟变量）one-hot-encoding-dummy-variables">4.1.1 One-Hot编码（虚拟变量）One-Hot-Encoding (Dummy variables) </a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n1160"><a class="md-toc-inner" href="#1检查字符串编码的分类数据--checking-string-encoded-categorical-data">1.<strong>检查字符串编码的分类数据  Checking string-encoded categorical data</strong> </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1180"><a class="md-toc-inner" href="#412-数字可以编码分类变量">4.1.2 数字可以编码分类变量</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1181"><a class="md-toc-inner" href="#42-分箱离散化线性模型与树-binning-discretization-linear-models-and-trees">4.2 分箱、离散化、线性模型与树 Binning, Discretization, Linear Models and Trees</a></span></p></div><h2><a name="supervised-learning" class="md-header-anchor"></a><span>Supervised Learning</span></h2><h2><a name="unsupervised-learning" class="md-header-anchor"></a><span>Unsupervised Learning</span></h2><h2><a name="python-libspackages" class="md-header-anchor"></a><span>Python Libs(Packages)</span></h2><h3><a name="scikit-learn" class="md-header-anchor"></a><span>scikit-learn</span></h3><ul><li><strong><span>Iris datasets</span></strong></li><li><span>//TODO...</span></li><li><span>scikit-learn中的train_test_split函数将75%的行数据及对应标签作为训练集，剩下25%的数据及其标签作为测试集</span></li><li><span>一部分数据用于</span><strong><span>构建机器学习模型</span></strong><span>，叫作训练数据（training data）或</span><strong><span>训练集</span></strong><span>（training set）。其余的数据用来</span><strong><span>评估模型性能</span></strong><span>，叫作测试数据（test data）、</span><strong><span>测试集</span></strong><span>（test set）或留出集（hold-out set）</span></li><li><span>scikit-learn中的</span><strong><span>数据</span></strong><span>通常用</span><strong><span>大写的X</span></strong><span>表示，而</span><strong><span>标签</span></strong><span>用</span><strong><span>小写的y</span></strong><span>表示</span></li><li><span>用大写的X是因为数据是一个二维数组（矩阵），用小写的y是因为目标是一个一维数组（向量），这也是数学中的约定</span></li></ul><h4><a name="depends-on-numpy-and-scipy" class="md-header-anchor"></a><span>depends on NumPy and SciPy</span></h4><h4><a name="numpykey-point" class="md-header-anchor"></a><span>Numpy(key point)</span></h4><h4><a name="scipy" class="md-header-anchor"></a><span>Scipy</span></h4><h4><a name="matplotlibkey-point" class="md-header-anchor"></a><span>matplotlib(key point)</span></h4><h4><a name="pandas" class="md-header-anchor"></a><span>pandas</span></h4><h4><a name="mglearn-本书github代码httpsgithubcomamuellerintroductiontomlwithpython" class="md-header-anchor"></a><span>mglearn </span><a href='https://github.com/amueller/introduction_to_ml_with_python'><span>本书github代码</span></a></h4><h2><a name="chapter2-supervised-learning-监督学习" class="md-header-anchor"></a><span>Chapter2 Supervised Learning 监督学习</span></h2><h3><a name="21-分类classifification）和回归regression）" class="md-header-anchor"></a><span>2.1 分类（classifification）和回归（regression）</span></h3><h4><a name="分类" class="md-header-anchor"></a><span>#分类</span></h4><ul><li><p><span>分类问题的目标是</span><strong><span>预测类别标签</span></strong><span>（class label），这些标签来自</span><strong><span>预定义的可选列表</span></strong></p></li><li><p><span>分类问题有时可分为</span><strong><span>二分类</span></strong><span> （binary classification，在两个类别之间进行区分的</span></p><p><span>一种特殊情况）和</span><strong><span>多分类</span></strong><span>（multiclass  classification，在两个以上的类别之间进行区分）</span></p></li><li><p><strong><span>二分类</span></strong><span>（寻找垃圾邮件）中，通常一个类别称为</span><strong><span>正类</span></strong><span>（positive class），另一个类别称为</span><strong><span>反类</span></strong><span>（negative class）</span></p></li><li><p><strong><span>多分类</span></strong><span>（鸢尾花，根据网站上的文本预测网站所用的语言。这里的类别就是预定义的语言表）</span></p></li></ul><h4><a name="回归" class="md-header-anchor"></a><span>#回归</span></h4><ul><li><p><span>回归任务的目标是</span><strong><span>预测一个连续值</span></strong><span>，编程术语叫作</span><strong><span>浮点数</span></strong><span>（floating-point number），数学术语叫作</span><strong><span>实数</span></strong><span>（real number）</span></p></li><li><p><span>举例：</span></p><ul><li><span>根据教育水平、年龄和居住地来预测一个人的</span><strong><span>年收入</span></strong></li><li><span>根据上一年的产量、天气和农场员工数等属性来预测玉米农场的</span><strong><span>产量</span></strong></li><li><span>预测值可以</span><strong><span>在给定范围内任意取值</span></strong></li></ul></li></ul><h4><a name="区分分类和回归" class="md-header-anchor"></a><span>#区分分类和回归</span></h4><ul><li><strong><span>输出是否具有某种连续性</span></strong><span>（ some kind of ordering or continuity in the output）</span></li></ul><h3><a name="22-泛化过拟合与欠拟合" class="md-header-anchor"></a><span>2.2 泛化、过拟合与欠拟合</span></h3><ul><li><p><span>如果一个模型能够对没见过的数据做出准确预测，我们就说它能够从</span><strong><span>训练集泛化</span></strong><span>（generalize）到</span><strong><span>测试集</span></strong><span>。我们想要构建一个泛化精度尽可能高的模型。</span></p></li><li><p><strong><span>通常</span></strong><span>来说，我们构建模型，使其在</span><strong><span>训练集</span></strong><span>上能够做出准确</span><strong><span>预测</span></strong><span>。如果训练集和测试集足够</span><strong><span>相似</span></strong><span>，我们预计模型在</span><strong><span>测试集</span></strong><span>上也能做出</span><strong><span>准确预测</span></strong><span>。</span></p></li><li><p><span>判断一个算法在新数据上表现好坏的</span><strong><span>唯一度量</span></strong><span>，就是在</span><strong><span>测试集</span></strong><span>上的评估，测试集是用来测试模型</span><strong><span>泛化性能</span></strong><span>的数据</span></p></li><li><p><strong><span>简单</span></strong><span>的模型对新数据的</span><strong><span>泛化</span></strong><span>能力</span><strong><span>更好</span></strong></p></li><li><p><span>模型</span><strong><span>过于复杂</span></strong><span>，被称为</span><strong><span>过拟合</span></strong><span>（</span><strong><span>overfitting</span></strong><span>）,在拟合模型时</span><strong><span>过分关注训练集的细节</span></strong><span>，得到了一个在</span><strong><span>训练集上表现很好</span></strong><span>(预测效果好)、但不能泛化到新数据上的模型</span></p></li><li><p><span>模型</span><strong><span>过于简单</span></strong><span>，模型甚至在训练集上的表现就很差，选择过于简单的模型被称为</span><strong><span>欠拟合</span></strong><span>（</span><strong><span>underfitting</span></strong><span>）</span></p></li><li><p><span>二者之间存在一个</span><strong><span>最佳位置</span></strong><span>，可以得到最好的泛化性能，过拟合与欠拟合之间的权衡：</span></p><p><img src=".\ML_COURSE\模型复杂度与训练精度和测试精度之间的权衡.png" referrerpolicy="no-referrer"></p></li></ul><h4><a name="模型复杂度与数据集大小的关系" class="md-header-anchor"></a><span>模型复杂度与数据集大小的关系</span></h4><ul><li><span>模型复杂度与训练数据集中输入的变化密切相关,数据集中包含的数据点的</span><strong><span>变化范围越大</span></strong><span>，在不发生过拟合的前提下你可以使用的</span><strong><span>模型就越复杂</span></strong><span>,收集</span><strong><span>更多数据</span></strong><span>，</span><strong><span>适当构建</span></strong><span>更复杂的模型，对监督学习任务往往特别有用</span></li></ul><h3><a name="23监督学习算法" class="md-header-anchor"></a><span>2.3监督学习算法</span></h3><h4><a name="231-一些样本数据集" class="md-header-anchor"></a><span>2.3.1 一些样本数据集</span></h4><p><span>使用低维数据集：（</span><strong><span>特征较少，可视化简单</span></strong><span>），结论不适用于高维数据集（特征较多）</span></p><ul><li><p><strong><span>模拟</span></strong><span>的forge二分类数据集，绘制散点图，</span><strong><span>第一个特征</span></strong><span>为x轴，</span><strong><span>第二个特征</span></strong><span>为y轴</span></p><p><code>mglearn.discrete_scatter(X[:, 0], X[:, 1], y)</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Out</span>[<span class="cm-number">2</span>]:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>.<span class="cm-property">shape</span>: (<span class="cm-number">26</span>, <span class="cm-number">2</span>) <span class="cm-comment">#这个数据集包含26个数据点和2个特征</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre></li><li><p><strong><span>模拟</span></strong><span>的wave数据集说明回归算法，wave 数据集只有</span></p><p><span>一个输入特征和一个连续的目标变量（或响应），后者是模型想要预测的对象。</span><strong><span>单一特征</span></strong><span>位于x轴，</span><strong><span>回归目标</span></strong><span>（输出）位于y轴。</span></p><p><span>现实数据集包含在scikit-learn中,通常被保存为Bunch对象,可以用点操作符来访问对象的值（比</span></p><p><span>如用</span><strong><span>bunch.key</span></strong><span>来代替bunch[&#39;key&#39;]）。</span></p></li><li><p><strong><span>现实</span></strong><span>世界的cancer数据集，肿瘤（良性：benign,恶性：malignant）,其任务是基于人体组织的测量数据来</span><strong><span>学习预测</span></strong><span>肿瘤是否为</span><strong><span>恶性</span></strong><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_breast_cancer</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cancer</span> = <span class="cm-variable">load_breast_cancer</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><code>cancer.data.shape: (569,30)</code><span> 569个数据点，每个数据点有30个特征，</span><strong><span>具体详见书本介绍</span></strong><span>。</span></p></li><li><p><strong><span>现实</span></strong><span>世界的</span><strong><span>回归</span></strong><span>数据集，即波士顿房价数据集。任务：利用犯罪率、是否邻近查尔斯河、公路可达性等信息，来预测20世纪70年代波士顿地区房屋价格的中位数。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_bostonboston</span> = <span class="cm-variable">load_boston</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><code>Data shape: (506, 13)</code></p><p><span>我们不仅将犯罪率和公路可达性作为特征，还将</span></p><p><span>犯罪率和公路可达性的</span><strong><span>乘积</span></strong><span>作为特征。像这样包含导出特征的方法叫作</span><strong><span>特征工程</span></strong><span>（feature </span></p><p><span>engineering）,将在第4章中详细讲述。</span></p></li></ul><h4><a name="232-k近邻-k-nearest-neighbor" class="md-header-anchor"></a><span>2.3.2 k近邻 k-Nearest Neighbor</span></h4><ul><li><p><span>最简单的机器学习算法</span></p></li><li><p><span>构建模型只需要保存</span><strong><span>训练数据集</span></strong><span>即可。想要</span></p><p><span>对新数据点做出</span><strong><span>预测</span></strong><span>，算法会在</span><strong><span>训练数据集中</span></strong><span>找到最近的数据点，也就是它的“</span><strong><span>最近邻</span></strong><span>”。</span></p><ol start='' ><li><p><strong><span>k近邻分类</span></strong></p><ul><li><p><span>k-NN算法最简单的版本只考虑一个最近邻（</span><strong><span>单一最近邻算法</span></strong><span>）：对于</span><strong><span>每个新数据点</span></strong><span>，标记了</span><strong><span>训练集中</span></strong><span>与它</span><strong><span>最近</span></strong><span>的点。</span></p></li><li><p><span>还可以考虑任意个（</span><strong><span>k个</span></strong><span>）邻居，用“</span><strong><span>投票法</span></strong><span>”（voting）来指定标签。就是说，对</span></p><p><span>于</span><strong><span>每个测试点</span></strong><span>，数一数多少个邻居属于类别0，多少个邻居属于类别1。然后将出现</span></p><p><strong><span>次数更多的类别</span></strong><span>（也就是k个近邻中占多数的类别）作为</span><strong><span>预测结果</span></strong><span>。（看图）同样适用于多分类数据集。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clf</span> = <span class="cm-variable">KNeighborsClassifier</span>(<span class="cm-variable">n_neighbors</span>=<span class="cm-number">3</span>) <span class="cm-comment">#实例化类</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clf</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>) <span class="cm-comment">#利用训练集对分类器进行拟合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set predictions: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">clf</span>.<span class="cm-property">predict</span>(<span class="cm-variable">X_test</span>)))<span class="cm-comment">#调用predict方法来对测试数据进行预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set accuracy: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">clf</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))<span class="cm-comment">#评估模型的泛化能力好坏，对测试数据和测试标签调用score方法</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre></li></ul></li><li><p><strong><span>分析KNeighborsClassifier</span></strong></p><p><span>根据平面中每个点所属的类别对平面进行着色。这样可以查看</span><strong><span>决策边界</span></strong><span>（decision boundary），即算法对类别0和类别1的</span><strong><span>分界线</span></strong><span>。（决策边界可视化，</span><strong><span>见书</span></strong><span>）：随着邻居个数越来越多，决策边界也越来越</span><strong><span>平滑</span></strong><span>。更平滑的边界对应</span><strong><span>更简单</span></strong><span>的模型。换句话说，</span><strong><span>使用更少的邻居对应更高的模型复杂度，而使用更多的邻居对应更低的模型复杂度</span></strong><span>。</span></p><p><span>书本图2-7：</span></p><p><span>	</span><strong><span>邻居数越多，模型越简单，训练集精度下降，测试集精度大体先升后降。</span></strong></p></li><li><p><strong><span>k近邻回归</span></strong><span> </span></p><p><span>...</span><strong><span>//todo</span></strong></p><ul><li><span>利用单一邻居的预测结果就是最近邻的目标值</span></li></ul></li></ol><ul><li><span>在使用多个近邻时，预测结果为这些邻居的平均值</span></li></ul></li></ul><ol start='4' ><li><p><span>分析KNeighborsRegressor</span></p><p><span>...</span></p></li><li><p><strong><span>优点、缺点和参数</span></strong></p><p><span>一般来说，KNeighbors分类器有</span><strong><span>2个</span></strong><span>重要参数：</span><strong><span>邻居个数</span></strong><span>与</span><strong><span>数据点之间距离的度量方法</span></strong><span>。</span></p><p><span>在实践中，使用</span><strong><span>较小</span></strong><span>的邻居个数（比如3个或5个）往往可以得到</span><strong><span>比较好</span></strong><span>的结果，但你应</span></p><p><span>该调节这个参数。</span><strong><span>默认</span></strong><span>使用</span><strong><span>欧式距离</span></strong><span>，它在</span></p><p><span>  许多情况下的效果都</span><strong><span>很好</span></strong><span>。</span></p><p><span>  k-NN的优点之一就是模型很</span><strong><span>容易理解</span></strong><span>，但如果训练集</span><strong><span>很大</span></strong><span>（特征数很多或者样本数很大），预测速度可能会</span><strong><span>比较慢</span></strong><span>。使用k-NN算法时，对数据进行</span><strong><span>预处理</span></strong><span>是</span><strong><span>很重要</span></strong><span>的（见第3章）。对于大多数特征的大多数取值都为0的数据集（所谓的</span><strong><span>稀疏数据集</span></strong><span>）来说，这一算法的效果</span><strong><span>尤其不好</span></strong><span>。（kNN在在实践中往往不会用到，下面的这种方法就没有这两个缺点）</span></p></li></ol><h4><a name="233--线性模型-linear-models" class="md-header-anchor"></a><span>2.3.3  线性模型 Linear models</span></h4><p><span>线性模型利用输入特征的线性函数（linear function）进行预测</span></p><ol start='' ><li><p><strong><span>用于回归的线性模型</span></strong></p><ul><li><p><span>对于回归问题，线性模型预测的一般公式如下：</span></p><p><strong><em><span>ŷ</span></em><span> = </span><em><span>w</span></em><span>[0] * </span><em><span>x</span></em><span>[0] + </span><em><span>w</span></em><span>[1] * </span><em><span>x</span></em><span>[1] + … </span><span>+</span><span> </span><em><span>w</span></em><span>[</span><em><span>p</span></em><span>] * </span><em><span>x</span></em><span>[</span><em><span>p</span></em><span>] + </span><em><span>b</span></em></strong></p></li></ul><p><em><span>x</span></em><span>[0] 到 </span><em><span>x</span></em><span>[</span><em><span>p</span></em><span>] 表示单个数据点的</span><strong><span>特征</span></strong><span>（本例中特征个数为 </span><em><span>p</span></em><span>+1），</span><em><span>w</span></em><span> 和 </span><em><span>b</span></em><span> 是学习模型的 </span></p><p><strong><span>参数</span></strong><span>，</span><em><span>ŷ</span></em><span> 是模型的</span><strong><span>预测结果</span></strong></p><ul><li><p><span>对于</span><strong><span>单一</span></strong><span>特征的数据集，公式如下：</span></p><p><strong><em><span>ŷ</span></em><span> = </span><em><span>w</span></em><span>[0] * </span><em><span>x</span></em><span>[0] + </span><em><span>b</span></em></strong></p><p><span>在一维 wave 数据集上学习参数 </span><em><span>w</span></em><span>[0] 和 </span><em><span>b</span></em><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">In</span>[<span class="cm-number">25</span>]:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mglearn</span>.<span class="cm-property">plots</span>.<span class="cm-property">plot_linear_regression_wave</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Out</span>[<span class="cm-number">25</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">w</span>[<span class="cm-number">0</span>]: <span class="cm-number">0.393906</span> <span class="cm-variable">b</span>: <span class="cm-operator">-</span><span class="cm-number">0.031804</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><p><span>用于回归的线性模型可以表示为这样的回归模型：对单一特征的预测结果是一条</span><strong><span>直线</span></strong><span>，两个特征时是一个</span><strong><span>平面</span></strong><span>，或者在更高维度（即更多特征）时是一个</span><strong><span>超平面</span></strong><span>。</span></p></li></ul></li><li><p><strong><span>线性回归（又名普通最小二乘法）</span></strong><span>（ordinary least squares，OLS）,是</span><strong><span>回归问题</span></strong><span>最简单也最经</span></p><p><span>典的线性方法</span></p><ul><li><p><span>线性回归寻找参数w和b，使得对训练集的预测值与真实的回归目标值y之间的</span><strong><span>均方误差最小</span></strong></p></li><li><p><strong><span>均方误差（mean squared error）</span></strong><span>是预测值与真实值之差的平方和除以样本数</span></p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n170" cid="n170" mdtype="math_block"><div class="md-rawblock-container md-math-container" tabindex="-1"><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.809ex" height="2.928ex" viewBox="0 -956.9 10251 1260.5" role="img" focusable="false" style="vertical-align: -0.705ex; max-width: 100%;"><defs><path stroke-width="0" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="0" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="0" id="E1-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="0" id="E1-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E1-MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">预</text></g><g transform="translate(1193,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">测</text></g><g transform="translate(1997,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">值</text></g><use xlink:href="#E1-MJMAIN-2212" x="3038" y="0"></use><g transform="translate(4038,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">真</text></g><g transform="translate(4842,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">实</text></g><g transform="translate(5647,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">值</text></g><g transform="translate(6466,0)"><use xlink:href="#E1-MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-32" x="550" y="583"></use></g><use xlink:href="#E1-MJMAIN-2F" x="7308" y="0"></use><g transform="translate(7808,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">样</text></g><g transform="translate(8612,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">本</text></g><g transform="translate(9431,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">数</text></g></g></svg></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">(预测值-真实值)^2/样本数</script></div></div></li><li><p><span>线性回归没有参数，这是一个优点，但也因此无法控制模型的复杂度</span></p></li><li><p><span>线性模型对</span><strong><span>wave数据集</span></strong><span>的预测结果（书P36 37）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">linear_model</span> <span class="cm-keyword">import</span> <span class="cm-variable">LinearRegressionX</span>, </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">y</span> = <span class="cm-variable">mglearn</span>.<span class="cm-property">datasets</span>.<span class="cm-property">make_wave</span>(<span class="cm-variable">n_samples</span>=<span class="cm-number">60</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X</span>, <span class="cm-variable">y</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#“斜率”参数（w，也叫作权重或系数）被保存在coef_属性中，而偏移或截距（b）被保存在intercept_属性中：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#intercept_属性是一个浮点数，而coef_属性是一个NumPy数组</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 159px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Training set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">lr</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>))) <span class="cm-number">0.67</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">lr</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))) <span class="cm-number">0.66</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>训练集和测试集上的分数非常接近。这说明可能存在</span><strong><span>欠拟合</span></strong><span>，而不是过拟合,对于一维数据集来说，过拟合的风险很小</span></p></li><li><p><span>线性模型对</span><strong><span>波士顿房价数据集(复杂模型)</span></strong><span>的预测结果</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">mglearn</span>.<span class="cm-property">datasets</span>.<span class="cm-property">load_extended_boston</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X</span>, <span class="cm-variable">y</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lr</span> = <span class="cm-variable">LinearRegression</span>().<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Training set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">lr</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>))) <span class="cm-number">0.95</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">lr</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))) <span class="cm-number">0.61</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>测试集预测比训练集</span><strong><span>低</span></strong><span>很多（</span><strong><span>过拟合</span></strong><span>），因此应该试图找到一个可以</span><strong><span>控制复杂度</span></strong><span>的模型。</span><strong><span>标准线性回归</span></strong><span>最常用的</span><strong><span>替代</span></strong><span>方法之一就是</span><strong><span>岭回归（ridge regression）</span></strong></p></li></ul></li><li><p><strong><span>岭回归</span></strong></p><ul><li><p><span>预测公式与</span><strong><span>普通最小二乘法</span></strong><span>相同</span></p></li><li><p><span>对系数（w）的选择不仅要在训练数据上得到好的预测结果，而且还要拟合附加约束</span></p></li><li><p><span>我们还希望</span><strong><span>系数尽量小</span></strong><span>。换句话说，w的所有元素都应接近于0。直观上来看，这意味着每个特征对输出的影响应</span><strong><span>尽可能小</span></strong><span>（即斜率很小），</span><strong><span>同时</span></strong><span>仍给出很好的预测结果。这种</span><strong><span>约束</span></strong><span>是所谓</span><strong><span>正则化（regularization）</span></strong><span>的一个例子</span></p></li><li><p><span>正则化是指对模型做</span><strong><span>显式约束</span></strong><span>，以</span><strong><span>避免过拟合</span></strong><span>，岭回归用到的这种被称为</span><strong><span>L2正则化</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">linear_model</span> <span class="cm-keyword">import</span> <span class="cm-variable">Ridge</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ridge</span> = <span class="cm-variable">Ridge</span>().<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Training set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">ridge</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>))) <span class="cm-number">0.89</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">ridge</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))) <span class="cm-number">0.75</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Ridge在训练集上的分数要低于LinearRegression，但在测试集上的分数更高。</span><strong><span>复杂度更小</span></strong><span>的模型意味着在</span><strong><span>训练集</span></strong><span>上的</span><strong><span>性能更差</span></strong><span>，但</span><strong><span>泛化性能更好</span></strong></p></li><li><p><strong><span>简单性</span></strong><span>和</span><strong><span>训练集性能</span></strong><span>二者对于模型的重要程度可以由用户通过设置</span><strong><span>alpha</span></strong><span>参数来指定</span></p></li><li><p><span>alpha的最佳设定取决于用到的</span><strong><span>具体数据集</span></strong></p></li><li><p><strong><span>增大alpha</span></strong><span>会使得</span><strong><span>系数更加趋向于0</span></strong><span>，从而降低训练集性能，但可能会</span><strong><span>提高泛化性能</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ridge10</span> = <span class="cm-variable">Ridge</span>(<span class="cm-variable">alpha</span>=<span class="cm-number">10</span>).<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li><li><p><strong><span>减小alpha</span></strong><span>可以让系数受到的</span><strong><span>限制更小</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ridge01</span> = <span class="cm-variable">Ridge</span>(<span class="cm-variable">alpha</span>=<span class="cm-number">0.1</span>).<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>从数学的观点来看，Ridge</span><strong><span>惩罚</span></strong><span>了系数的L2范数或w的欧式长度</span></p></li><li><p><span>还有一种方法可以用来理解</span><strong><span>正则化的影响</span></strong><span>，就是固定alpha值，但</span><strong><span>改变训练数据量</span></strong><span>，(例:对波士顿房价数据集做</span><strong><span>二次抽样</span></strong><span>,...将模型性能作为数据集大小的函数进行绘图，这样的图像叫作</span><strong><span>学习曲线</span></strong></p></li><li><p><span>//TODO...</span></p></li></ul></li><li><p><span>lasso</span></p><ul><li><p><span>除了Ridge，还有一种</span><strong><span>正则化的线性回归</span></strong><span>是Lasso。与岭回归相同，使用lasso也是</span><strong><span>约束系数使其接近于0</span></strong><span>，但用到的方法不同，叫作</span><strong><span>L1正则化</span></strong></p></li><li><p><span>L1正则化的结果是，使用lasso时某些系数</span><strong><span>刚好为0</span></strong><span>。这说明某些特征被模型完全忽略</span></p></li><li><p><span>与Ridge类似，Lasso也有一个正则化参数</span><strong><span>alpha</span></strong><span>，可以控</span></p><p><span>制</span><strong><span>系数趋向于0的强度</span></strong><span>。在上一个例子中，我们用的是默认值alpha=1.0。为了</span><strong><span>降低</span></strong><span>欠拟</span></p><p><span>合，我们尝试</span><strong><span>减小alpha</span></strong><span>。这么做的同时，我们还需要</span><strong><span>增加max_iter</span></strong><span>的值（运行迭代的最</span></p><p><span>大次数）</span></p></li></ul></li></ol><h4><a name="234-朴素贝叶斯分类器-naive-bayes-classifiers" class="md-header-anchor"></a><span>2.3.4 朴素贝叶斯分类器 Naive Bayes Classifiers</span></h4><ul><li><p><span>训练速度更快，泛化能力比线性分类器稍差</span></p></li><li><p><span>朴素贝叶斯模型如此高效的原因在于，它通过</span><strong><span>单独</span></strong><span>查看</span><strong><span>每个特征</span></strong><span>来学习参数，并从每个特征中收集简单的类别统计数据</span></p></li><li><p><span>scikit-learn 中实现了三种朴素贝叶斯分类器：GaussianNB(</span><strong><span>高斯</span></strong><span>:任意连续数据)、BernoulliNB (</span><strong><span>伯努利</span></strong><span>:二分类)和 MultinomialNB(</span><strong><span>多项式</span></strong><span>:假定输入数据为计数数据(每个特征代表某个对象的整数计数))</span></p><ul><li><p><span>BernoulliNB 分类器计算</span><strong><span>每个特征不为0</span></strong><span>的元素个数，代码见书P53</span></p></li><li><p><span>MultinomialNB</span></p><p><span>计算每个类别中</span><strong><span>每个特征</span></strong><span>的</span><strong><span>平均值</span></strong></p></li><li><p><span>GaussianNB</span></p><p><span>保存每个类别中</span><strong><span>每个特征</span></strong><span>的</span><strong><span>平均值</span></strong><span>和</span><strong><span>标准差</span></strong></p></li><li><p><strong><span>优点、缺点和参数</span></strong></p><ul><li><span>MultinomialNB和BernoulliNB都只有一个参数</span><strong><span>alpha</span></strong><span>，用于控制模型复杂度。可以将统计数据“平滑化”（smoothing）。alpha越大，平滑化越强，模型复杂度就越低。</span></li><li><span>GaussianNB主要用于</span><strong><span>高维数据</span></strong><span>，而另外两种朴素贝叶斯模型则广泛用于</span><strong><span>稀疏计数数据</span></strong><span>，比如文本。MultinomialNB的性能通常要优于BernoulliNB，特别是在包含很多非零特征的数据集（即大型文档）上</span></li><li><span>该模型对</span><strong><span>高维稀疏数据</span></strong><span>的效果很好，对参数的鲁棒性也相对较好。朴素贝叶斯模型是很好的基准模型，常用于</span><strong><span>非常大</span></strong><span>的数据集</span></li></ul></li></ul></li><li><p><span>补充：</span></p><p><strong><span>贝叶斯公式</span></strong></p><p><img src=".\ML_COURSE\贝叶斯公式.png" style="zoom:50%;" /></p><p><img src=".\ML_COURSE\Bayes_Training_data.png" style="zoom:50%;" /></p><p><img src=".\ML_COURSE\bayes_solution.png" style="zoom:50%;" /></p></li></ul><h4><a name="235-决策树-decision-trees" class="md-header-anchor"></a><span>2.3.5 决策树 Decision trees</span></h4><ul><li><p><span>决策树是广泛用于</span><strong><span>分类</span></strong><span>和</span><strong><span>回归</span></strong><span>任务的模型</span></p></li><li><p><strong><span>构造决策树</span></strong></p><p><span>对数据反复进行</span><strong><span>递归划分</span></strong><span>，直到划分后的每个区域（决策树的每个</span><strong><span>叶结点</span></strong><span>）只包含单一目标值（单一类别或单一回归值）。如果树中某个叶结点所包含数据点的目标值都相同，那么这个叶结点就是纯的（pure）</span></p><p><span>举例：</span><strong><span>two_moons数据集</span></strong></p></li><li><p><strong><span>控制决策树的复杂度</span></strong></p><ul><li><p><span>通常来说，构造决策树直到所有叶结点都是</span><strong><span>纯的叶结点</span></strong><span>，这会导致模型</span><strong><span>非常复杂</span></strong><span>，并且对训练数据</span><strong><span>高度过拟合</span></strong><span>。纯叶结点的存在说明这棵树在</span><strong><span>训练集</span></strong><span>上的精度是 </span><strong><span>100%</span></strong></p><p><img src=".\ML_COURSE\Decision_Tree_1.png" style="zoom:50%;" /></p><p><span>上图可以看出过拟合，在所有属于类别0的点中间有一块属于类别1的区域。另一方面，有一小条属于类别0的区域，包围着最右侧属于类别0的那个点。这并不是想象中决策边界的样子，这个</span><strong><span>决策边界</span></strong><span>过于关注</span><strong><span>远离</span></strong><span>同类别其他点的单个异常点</span></p></li><li><p><strong><span>防止过拟合</span></strong><span>的</span><strong><span>两种</span></strong><span>常见策略</span></p><ul><li><p><span>及早停止树的生长，也叫</span><strong><span>预剪枝（pre-pruning）</span></strong><span>（限制条件可能包括限制树的最大深度(max_depth)、限制叶结点的最大数目(max_leaf_nodes)，或者规定一个结点中数据点的最小数目(min_samples_leaf)来防止继续划分）</span></p></li><li><p><span>先构造树，但随后删除或折叠信息量很少的结点，也叫</span><strong><span>后剪枝（post-pruning）</span></strong><span>或</span><strong><span>剪枝（pruning）</span></strong></p></li><li><p><strong><span>scikit-learn</span></strong><span>的决策树在DecisionTreeRegressor类和DecisionTreeClassifier类中实现。</span></p><p><span>scikit-learn</span><strong><span>只实现了预剪枝</span></strong><span>，没有实现后剪枝</span></p></li><li><p><span>在</span><strong><span>乳腺癌(Breast</span>
<span>Cancer)数据集</span></strong><span>查看预剪枝的效果，固定树的random_state（随机数种子：保持不变，则每次随机结果相同，方便对比）</span></p><p><strong><span>默认</span></strong><span>展开树(纯叶子结点)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cancer</span> = <span class="cm-variable">load_breast_cancer</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">cancer</span>.<span class="cm-property">data</span>, <span class="cm-variable">cancer</span>.<span class="cm-property">target</span>, <span class="cm-variable">stratify</span>=<span class="cm-variable">cancer</span>.<span class="cm-property">target</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span> = <span class="cm-variable">DecisionTreeClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on training set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">tree</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on test set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">tree</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 159px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">1.000</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.937</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>预剪枝</span></strong><span> </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span> = <span class="cm-variable">DecisionTreeClassifier</span>(<span class="cm-variable">max_depth</span>=<span class="cm-number">4</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.988</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.951</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>降低了训练集的精度，提高了测试集的精度</span></strong></p></li></ul></li></ul></li><li><p><strong><span>分析决策树</span></strong></p><ul><li><span>利用tree模块的export_graphviz函数来将树可视化</span></li></ul></li><li><p><strong><span>树的特征重要性（feature importance）</span></strong></p><ul><li><p><span>为每个特征对树的决策的重要性</span></p><p><span>进行排序，它都是一个介于0和1之间的数字</span></p></li><li><p><span>如果某个特征的feature_importance_很小，并</span><strong><span>不能说明</span></strong><span>这个特征没有提供任何信息，这只能说明该特征没有被树选中，可能是因为另一个特征也包含了同样的信息</span></p></li><li><p><span>与线性模型的系数不同，特征重要性始终为</span><strong><span>正数</span></strong><span>，也</span><strong><span>不能说明</span></strong><span>该特征对应哪个类别</span></p></li></ul></li><li><p><strong><span>优点、缺点和参数(Strengths, weaknesses and parameters)</span></strong></p><ul><li><span>线性模型和回归树对RAM价格数据的预测结果对比</span></li></ul><p><img src=".\ML_COURSE\decision_tree VS linear_model prediction.png" style="zoom: 50%;" /></p><p><span>	</span><span>线性模型对测试数据(2000年以后)给出了很好的预测，不过忽略了训练数据和测试数据中一些更细微的变化。与之相反，树模型完美预测了</span><strong><span>训练</span></strong><span>数据，但是，一旦输入</span><strong><span>超出</span></strong><span>了模型训练数据的范围，模型就只能持续预测最后一个已知数据点，树不能在训练数据的范围之外生成“新的”响应。所有基于树的模型都有这个</span><strong><span>缺点</span></strong></p><ul><li><p><span>决策树有两个</span><strong><span>优点</span></strong><span>：</span></p><ul><li><span>得到的模型很容易可视化，容易理解(non-experted)</span></li><li><span>算法完全不受</span><strong><span>数据缩放</span></strong><span>(data scaling)的影响。由于</span><strong><span>每个特征</span></strong><span>被</span><strong><span>单独处理</span></strong><span>(processed separately)，而且数据的划分也</span><strong><span>不依赖于缩放</span></strong><span>，因此决策树算法</span><strong><span>不需要特征预处理</span></strong><span>，比如归一化(normalization)或标准化(standardization)。</span><strong><span>特别是</span></strong><span>特征的</span><strong><span>尺度</span></strong><span>(scales)完全不一样时或者二元特征和连续特征</span><strong><span>同时</span></strong><span>(mix of binary and continuous features)时，决策树的</span><strong><span>效果很好</span></strong></li></ul></li><li><p><span>决策树的</span><strong><span>主要缺点</span></strong><span>在于，即使做了预剪枝，它也经常会</span><strong><span>过拟合</span></strong><span>，</span><strong><span>泛化性能很差</span></strong><span>。因此，在大多数应用中，往往使用下面介绍的</span><strong><span>集成方法</span></strong><span>来替代单棵决策树</span></p></li></ul></li></ul><h4><a name="236-决策树集成-ensembles-of-decision-trees" class="md-header-anchor"></a><span>2.3.6 决策树集成 Ensembles of Decision Trees</span></h4><p><span>	</span><span>都以决策树为基础</span><strong><span>两种</span></strong><span>集成模型：</span></p><p><span>	</span><strong><span>随机森林（random forest）</span></strong><span>和</span><strong><span>梯度提升决策树（gradient boosted decision tree）</span></strong></p><h5><a name="1随机森林-random-forest" class="md-header-anchor"></a><span>1.随机森林 random forest </span></h5><ul><li><p><span>随机森林背后的</span><strong><span>思想</span></strong><span>(idea)是，每棵树的预测可能都相对较好，但可能对</span><strong><span>部分数据过拟合</span></strong><span>。</span></p><p><span>如果构造很多树，并且每棵树的预测都很好，但都以不同的方式过拟合，那么我们可以对</span></p></li></ul><p><span>       这些树的结果</span><strong><span>取平均值</span></strong><span>来</span><strong><span>降低过拟合</span></strong><span>。既能</span><strong><span>减少过拟合又能保持树的预测能力</span></strong></p><ul><li><p><span>随机森林中树的</span><strong><span>随机化方法</span></strong><span>有两种：</span></p><ul><li><span>通过选择用于构造树的</span><strong><span>数据点</span></strong></li><li><span>通过选择</span><strong><span>每次划分测试的特征</span></strong><span>(the features in each split test)</span></li></ul></li><li><p><strong><span>构造随机森林</span></strong></p><ul><li><p><span>构造树的个数(</span><strong><span>n_estimators参数</span></strong><span>)</span></p></li><li><p><span>算法对每棵树进行不同的</span><strong><span>随机</span></strong><span>选择,以确保树和树之间是有区别的(彼此独立)</span></p></li><li><p><span>想要构造一棵树，首先要对数据进行</span><strong><span>自助采样（bootstrap sample）</span></strong><span>,从n_samples个数据点中</span><strong><span>有放回地</span></strong><span>（即同一样本可以被多次抽取）</span><strong><span>重复随机抽取</span></strong><span>一个样本，共抽取</span><strong><span>n_samples次</span></strong><span>，有些数据点会缺失(missing)或重复(repeated)</span></p></li><li><p><span>接下来，基于这个</span><strong><span>新创建的数据集</span></strong><span>来构造决策树，对之前介绍的决策树算法稍作修改：在每个结点处，算法</span><strong><span>随机选择特征的一个子集</span></strong><span>，并对</span><strong><span>其中一个特征</span></strong><span>寻找</span><strong><span>最佳测试</span></strong><span>，而</span><strong><span>不是</span></strong><span>对每个结点都寻找最佳测试。选择的特征个数由</span><strong><span>max_features</span></strong><span>参数来控制</span></p></li><li><p><span>两种方法结合保证随机森林</span></p><ul><li><strong><span>自助采样</span></strong><span>：</span><strong><span>每棵决策树</span></strong><span>的</span><strong><span>数据集都是略有不同</span></strong></li><li><span>每个结点的</span><strong><span>特征选择</span></strong><span>：</span><strong><span>每棵树</span></strong><span>中的</span><strong><span>每次划分</span></strong><span>都是</span><strong><span>基于特征的不同子集</span></strong></li></ul></li><li><p><span>如果max_features</span><strong><span>等于n_features</span></strong><span>，那么每次划分都要考虑数据集的</span><strong><span>所有特征</span></strong><span>，在</span><strong><span>特征选择</span></strong><span>的过程中</span><strong><span>没有</span></strong><span>添加</span><strong><span>随机性</span></strong><span>（不过</span><strong><span>自助采样依然存在随机性</span></strong><span>）如果设置max_features</span><strong><span>等于1</span></strong><span>，那么在划分时将无法选择对哪个特征进行测试，只能对随机选择的某个特征搜索不同的阈值。因此，如果max_features</span><strong><span>较大</span></strong><span>，那么随机森林中的树将会</span><strong><span>十分相似</span></strong><span>(抽样和选择</span><strong><span>重复率高</span></strong><span>)，利用</span><strong><span>最独特的特征</span></strong><span>可以</span><strong><span>轻松拟合数据</span></strong><span>。如果max_features</span><strong><span>较小</span></strong><span>，那么随机森林中的树将会</span><strong><span>差异很大</span></strong><span>，</span><strong><span>为了</span></strong><span>很好地</span><strong><span>拟合</span></strong><span>数据，每棵树的</span><strong><span>深度都要很大</span></strong></p></li><li><p><span>利用随机森林进行</span><strong><span>预测</span></strong><span>，算法首先对森林中的</span><strong><span>每棵树</span></strong><span>进行预测</span></p><ul><li><span>对于</span><strong><span>回归</span></strong><span>问题：可以对这些结果</span><strong><span>取平均值</span></strong><span>作为最终预测</span></li><li><span>对于</span><strong><span>分类</span></strong><span>问题：用到了</span><strong><span>“软投票”（soft voting）</span></strong><span>策略，每个算法做出“软”预测，给出每个可能的输出标签的</span><strong><span>概率</span></strong><span>。对所有树的预测概率</span><strong><span>取平均值</span></strong><span>，然后将</span><strong><span>概率最大</span></strong><span>的类别作为预测结果</span></li></ul></li><li><p><strong><span>分析随机森林</span></strong></p><ul><li><p><span>将由5棵树组成的随机森林应用到前面研究过的</span><strong><span>two_moons数据集</span></strong><span>上：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_moons</span>(<span class="cm-variable">n_samples</span>=<span class="cm-number">100</span>, <span class="cm-variable">noise</span>=<span class="cm-number">0.25</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">3</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X</span>, <span class="cm-variable">y</span>, <span class="cm-variable">stratify</span>=<span class="cm-variable">y</span>, &nbsp; &nbsp; <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>) <span class="cm-comment">#42</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span> = <span class="cm-variable">RandomForestClassifier</span>(<span class="cm-variable">n_estimators</span>=<span class="cm-number">5</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">2</span>) <span class="cm-comment">#5棵树</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre></li><li><p><span>每棵树学到的</span><strong><span>决策边界</span></strong><span>可视化，也将它们的总预测（即整个森林做出的预测）</span><strong><span>可视化</span></strong><span>：</span></p><p><img src=".\ML_COURSE\two_moons decision boundary.png" style="zoom:50%;" /></p><p><span>5棵树学到的</span><strong><span>决策边界大不相同</span></strong><span>。每棵树都犯了一些错误，因为这里画出的一些训练点实际上</span><strong><span>并没有包含</span></strong><span>在这些树的训练集中，原因在于</span><strong><span>自助采样</span></strong><span>。随机森林比单独每一棵树的过拟合都要小，给出的决策边界也更符合直觉。用到</span><strong><span>更多棵树</span></strong><span>（通常是几百或上千），从而得到</span><strong><span>更平滑</span></strong><span>的边界</span></p></li><li><p><span>将包含</span><strong><span>100棵树</span></strong><span>的随机森林应用在</span><strong><span>cancer数据集</span></strong><span>上:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span> = <span class="cm-variable">RandomForestClassifier</span>(<span class="cm-variable">n_estimators</span>=<span class="cm-number">100</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on training set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">forest</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on test set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">forest</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">1.000</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.972</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>在没有调节任何参数的情况下，精度比线性模型或单棵决策树都要</span><strong><span>好</span></strong></p></li></ul></li><li><p><span>类似地，随机森林也可以给出</span><strong><span>特征重要性</span></strong><span>（feature importance），计算方法是将森林中</span><strong><span>所有树</span></strong><span>的</span><strong><span>特征重要性</span></strong><span>求和并</span><strong><span>取平均</span></strong><span>，随机森林给出的特征重要性要比单棵树给出的更为</span><strong><span>可靠</span></strong><span>：</span></p><p><span>图见P67</span></p><p><span>与单棵树相比，随机森林中有</span><strong><span>更多</span></strong><span>特征的重要性</span><strong><span>不为零</span></strong></p></li><li><p><strong><span>优点、缺点和参数</span></strong></p><ul><li><p><span>用于</span><strong><span>回归和分类的随机森林</span></strong><span>是目前应用</span><strong><span>最广泛</span></strong><span>的机器学习方法之一，</span><strong><span>不需要</span></strong><span>反复调节参数，</span><strong><span>不需要</span></strong><span>对数据进行缩放</span></p></li><li><p><span>在大型数据集上构建随机森林可能比较</span><strong><span>费时间</span></strong><span>，但在一台计算机的多个CPU内核上并行计算也很容易，可以用</span><strong><span>n_jobs参数</span></strong><span>来调节使用的</span><strong><span>内核个数</span></strong><span>。使用更多的CPU内核，可以让</span><strong><span>速度线性增加</span></strong><span>（使用2个内核，随机森林的训练速度会</span><strong><span>加倍</span></strong><span>）</span></p></li><li><p><span>森林中的</span><strong><span>树越多</span></strong><span>，它对随机状态选择的</span><strong><span>鲁棒性</span></strong><span>就越好</span></p></li><li><p><span>对于</span><strong><span>维度非常高</span></strong><span>的</span><strong><span>稀疏数据</span></strong><span>（比如</span><strong><span>文本数据</span></strong><span>），随机森林的表现往往</span><strong><span>不是很好</span></strong><span>。对于这种</span></p><p><span>数据，使用</span><strong><span>线性模型可能更合适</span></strong><span>，对一个应用来说，如果时间和内存很重要的话，那么</span><strong><span>换用</span></strong><span>线性模型可能更为明智</span></p></li><li><p><span>调参：</span></p><ul><li><span>n_estimators总是</span><strong><span>越大越好</span></strong><span>，在你的时间/内存允许的情况下</span><strong><span>尽量多</span></strong></li><li><span>max_features决定每棵树的随机性大小，较小的max_features可以</span><strong><span>降低过拟合</span></strong><span>,一般来说，好的经验就是使用</span><strong><span>默认值</span></strong><span>：对于</span><strong><span>分类</span></strong><span>，默认值是</span><strong><span>max_features=sqrt(n_features)</span></strong><span>；对于</span><strong><span>回归</span></strong><span>，默认值是</span><strong><span>max_features=log2(n_features)</span></strong><span>。增大max_features或max_leaf_nodes有时也可以</span><strong><span>提高</span></strong><span>性能（improve performance）。它还可以大大降低用于训练和预测的时间和空间要求</span></li></ul></li></ul></li></ul></li></ul><h5><a name="2梯度提升回归树梯度提升机）-gradient-boosted-regression-tree-gradient-boosting-machines" class="md-header-anchor"></a><span>2.梯度提升回归树（梯度提升机） gradient boosted regression tree (gradient boosting machines)</span></h5><ul><li><p><span>这个模型既可以用于回归也可以用于分类</span></p></li><li><p><span>与随机森林方法不同，梯度提升采用</span><strong><span>连续</span></strong><span>的方式构造树，每棵树都试图</span><strong><span>纠正</span></strong><span>前一棵树的错误。</span><strong><span>默认</span></strong><span>情况下，</span></p><p><span>梯度提升回归树中</span><strong><span>没有随机化</span></strong><span>，而是用到了</span><strong><span>强预剪枝</span></strong></p></li><li><p><span>梯度提升树通常使用</span><strong><span>深度很小</span></strong><span>（1到5之间）的树，这样模型占用的</span><strong><span>内存更少</span></strong><span>，预测速度也</span><strong><span>更快</span></strong></p></li><li><p><span>梯度提升背后的主要思想是合并许多简单的模型（在这个语境中叫作</span><strong><span>弱学习器</span></strong><span>），比如深</span></p><p><span>度较小的树。每棵树只能对部分数据做出好的预测，因此，添加的树越来越多，可以</span><strong><span>不断</span></strong></p><p><strong><span>迭代提高性能</span></strong></p></li><li><p><span>对参数设置更敏感，除了预剪枝与集成中树的数量之外，梯度提升的另一个重要参数是</span><strong><span>learning_rate（学习</span></strong></p><p><strong><span>率）</span></strong><span>，用于</span><strong><span>控制</span></strong><span>每棵树</span><strong><span>纠正前一棵树的错误的强度</span></strong><span>。较高的学习率意味着每棵树都可以做出较强的修正，这样模型</span><strong><span>更为复杂</span></strong><span>。通过增大n_estimators来向集成中添加更多树，也可以</span><strong><span>增加模型复杂度</span></strong><span>，因为模型有</span><strong><span>更多机会</span></strong><span>纠正训练集上的错误</span></p></li><li><p><span>乳腺癌数据集上应用GradientBoostingClassifier的示例。默认使用100棵树，最大深度是3，学习率为0.1</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span> = <span class="cm-variable">GradientBoostingClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on training set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">gbrt</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on test set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">gbrt</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">1.000</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.958</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>由于训练集精度达到100%，所以很可能存在过拟合。为了降低过拟合，我们可以</span><strong><span>限制最大深度</span></strong><span>来加强预剪枝，也可以</span><strong><span>降低学习率</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># max_depth=1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span> = <span class="cm-variable">GradientBoostingClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>, <span class="cm-variable">max_depth</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.991</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.972</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># learning_rate=0.01</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span> = <span class="cm-variable">GradientBoostingClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>, <span class="cm-variable">learning_rate</span>=<span class="cm-number">0.01</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbrt</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.988</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.965</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>两种方法都降低了训练集精度，在这个例子中，减小树的最大深度</span><strong><span>显著提升</span></strong><span>了模型性能，而降低学习率仅稍稍提高了泛化性能</span></p></li><li><p><span>将</span><strong><span>特征重要性</span></strong><span>可视化</span></p><p><img src=".\ML_COURSE\feature importances gradient boosting cancer.png" style="zoom:50%;" /></p><p><span>梯度提升树的特征重要性与随机森林的特征重要性有些类似，不过梯度提升</span><strong><span>完全忽略了某些特征</span></strong></p></li><li><p><span>由于梯度提升和随机森林两种方法在类似的数据上表现得都很好，因此一种常用的方法就是</span><strong><span>先尝试随机森林</span></strong><span>，它的</span><strong><span>鲁棒性</span></strong><span>很好。如果随机森林效果很好，但预测时间</span><strong><span>太长</span></strong><span>，或者机器学习模型</span><strong><span>精度</span></strong><span>小数点后第二位的</span><strong><span>提高</span></strong><span>也很重要，那么</span><strong><span>切换成梯度提升</span></strong><span>通常会有用</span></p></li><li><p><strong><span>优点、缺点和参数</span></strong></p><ul><li><p><span>其</span><strong><span>主要缺点</span></strong><span>是需要</span><strong><span>仔细调参</span></strong><span>，而且</span><strong><span>训练时间</span></strong><span>可能会</span><strong><span>比较长</span></strong></p></li><li><p><span>这一算法</span><strong><span>不需要</span></strong><span>对数据进行缩放就可以表现得很好，而且</span><strong><span>也适用</span></strong><span>于二元特征与连续特征同时存在的数</span></p><p><span>据集。与其他基于树的模型相同，它也通常</span><strong><span>不适用</span></strong><span>于</span><strong><span>高维稀疏数据</span></strong></p></li><li><p><strong><span>主要参数</span></strong><span>包括</span><strong><span>树的数量n_estimators</span></strong><span>和</span><strong><span>学习率learning_rate</span></strong><span>（用于控制每棵树对前一棵树的错误的纠正强度）</span></p></li><li><p><span>这两个参数</span><strong><span>高度相关</span></strong><span>（highly interconnected），因为learning_rate</span><strong><span>越低</span></strong><span>，就需要</span><strong><span>更多的树</span></strong><span>来构建具有相似复杂度的模型</span></p></li><li><p><span>随机森林的n_estimators值总是越大越好，但梯度提升不同，增大n_estimators会导致模型更加复杂，进而可能导致</span><strong><span>过拟合</span></strong><span>，</span><strong><span>通常</span></strong><span>的做法是根据</span><strong><span>时间和内存</span></strong><span>的预算（budget）选择合适的n_estimators，然后对不同的learning_rate进行遍历</span></p></li><li><p><span>另一个</span><strong><span>重要参数</span></strong><span>是max_depth（或max_leaf_nodes），用于降低每棵树的复杂度。梯度提升模型的max_depth一般不超过5</span></p></li></ul></li></ul><h4><a name="237-核支持向量机-kernelized-support-vector-machines-svm）" class="md-header-anchor"></a><span>2.3.7 核支持向量机 Kernelized Support Vector Machines （SVM）</span></h4><p><span>	</span><span>//TODO...</span></p><ol start='' ><li><p><strong><span>线性模型与非线性特征</span></strong></p><ul><li><span>让线性模型更加灵活，就是添加更多的特征——举个例子，添加</span><strong><span>输入特征的交互项</span></strong><span>或</span><strong><span>多项式</span></strong></li><li><span>现在我们对输入特征进行</span><strong><span>扩展</span></strong><span>，比如说添加第二个特征的平方（feature1 ** 2）作为一个新特征，将每个数据点表示为</span><strong><span>三维点</span></strong><span>(feature0, feature1, feature1 ** 2)，而不是二维点(feature0, feature1)</span></li></ul></li><li><p><strong><span>核技巧 （kernel trick）</span></strong></p><ul><li><span>向数据表示中添加</span><strong><span>非线性特征</span></strong><span>，可以让线性模型变得更强大</span></li><li><strong><span>原理</span></strong><span>：直接计算扩展特征表示中数据点之间的距离（更准确地说是</span><strong><span>内积</span></strong><span>），而不用实际对扩展进行计算</span></li><li><span>对于支持向量机，将数据</span><strong><span>映射到更高维空间</span></strong><span>中有</span><strong><span>两种</span></strong><span>常用的方法：一种是</span><strong><span>多项式核</span></strong><span>，在一定阶数内计算原始特征所有可能的多项式（比如feature1 ** 2 * feature2 ** 5）；另一种是径向基函数（radial basis function，</span><strong><span>RBF</span></strong><span>）核，也叫</span><strong><span>高斯核</span></strong></li><li><span>一种对高斯核的</span><strong><span>解释</span></strong><span>是它考虑所有阶数的所有可能的多项式，但</span><strong><span>阶数越高</span></strong><span>，</span><strong><span>特征的重要性越小</span></strong></li></ul></li><li><p><strong><span>理解SVM</span></strong></p><ul><li><p><span>在训练过程中，SVM</span><strong><span>学习每个训练数据点</span></strong><span>对于</span><strong><span>表示两个类别之间的决策边界</span></strong><span>的</span><strong><span>重要性</span></strong><span>。通</span></p><p><span>常只有</span><strong><span>一部分</span></strong><span>训练数据点对于定义决策边界来说很重要：位于</span><strong><span>类别之间边界</span></strong><span>上的那些</span><strong><span>点</span></strong><span>。</span></p><p><span>这些点叫作</span><strong><span>支持向量（support vector）</span></strong><span>，支持向量机正是由此得名</span></p></li></ul></li><li><p><strong><span>SVM调参</span></strong></p><ul><li><p><span>将</span><strong><span>RBF核SVM</span></strong><span>应用到</span><strong><span>乳腺癌数据集</span></strong><span>上。默认情况下，C=1，gamma=1/n_features：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>( &nbsp; &nbsp;<span class="cm-variable">cancer</span>.<span class="cm-property">data</span>, <span class="cm-variable">cancer</span>.<span class="cm-property">target</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span> = <span class="cm-variable">SVC</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on training set: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">svc</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on test set: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">svc</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">1.00</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.63</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>训练集上的分数十分完美，但在测试集上的精度只有63%，存在</span><strong><span>相当严重的过拟合</span></strong></p></li><li><p><span>SVM对</span><strong><span>参数的设定</span></strong><span>和</span><strong><span>数据的缩放</span></strong><span>非常</span><strong><span>敏感</span></strong><span>。特别地，它要求所有特征有</span><strong><span>相似的变化范围</span></strong></p><p><span>查看breast cancer数据集的特征范围：</span></p><p><img src=".\ML_COURSE\cancer magnitude.png" style="zoom: 33%;" /></p><p><span>乳腺癌数据集的特征具有</span><strong><span>完全不同的数量级</span></strong><span>，这对其他模型来说（比如</span><strong><span>线性模型</span></strong><span>）可能是</span><strong><span>小问题</span></strong><span>，但对</span><strong><span>核SVM</span></strong><span>却有</span><strong><span>极大影响</span></strong></p></li></ul></li><li><p><strong><span>为SVM预处理数据</span></strong></p><ul><li><p><span>解决这个问题的一种方法就是对</span><strong><span>每个特征</span></strong><span>进行</span><strong><span>缩放</span></strong><span>，使其大致都位于同一范围（常用的缩放方法就是将所有特征缩放到0和1之间 </span><strong><span>MinMaxScaler</span></strong><span>）</span></p></li><li><p><span>手动实现MinMax缩放：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-variable">IN</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 计算训练集中每个特征的最小值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_on_training</span> = <span class="cm-variable">X_train</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 计算训练集中每个特征的范围（最大值-最小值）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">range_on_training</span> = (<span class="cm-variable">X_train</span> <span class="cm-operator">-</span> <span class="cm-variable">min_on_training</span>).<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 减去最小值，然后除以范围</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 这样每个特征都是min=0和max=1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = (<span class="cm-variable">X_train</span> <span class="cm-operator">-</span> <span class="cm-variable">min_on_training</span>) <span class="cm-operator">/</span> <span class="cm-variable">range_on_training</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Minimum for each feature\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Maximum for each feature\n {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 227px;"></div><div class="CodeMirror-gutters" style="display: none; height: 227px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-variable">OUT</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Minimum</span> <span class="cm-keyword">for</span> <span class="cm-variable">each</span> <span class="cm-variable">feature</span>[ <span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span> &nbsp;<span class="cm-number">0.</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Maximum</span> <span class="cm-keyword">for</span> <span class="cm-variable">each</span> <span class="cm-variable">feature</span> [ <span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp; <span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span> &nbsp;<span class="cm-number">1.</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-variable">IN</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 利用训练集的最小值和范围对测试集做相同的变换（详见第3章）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = (<span class="cm-variable">X_test</span> <span class="cm-operator">-</span> <span class="cm-variable">min_on_training</span>) <span class="cm-operator">/</span> <span class="cm-variable">range_on_training</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span> = <span class="cm-variable">SVC</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>) <span class="cm-comment"># X_train_scaled</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on training set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">svc</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Accuracy on test set: {:.3f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">svc</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test_scaled</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 181px;"></div><div class="CodeMirror-gutters" style="display: none; height: 181px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-variable">OUT</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.948</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.951</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>数据缩放的作用很大！实际上模型现在处于</span><strong><span>欠拟合</span></strong><span>的状态，因为训练集和测试集的</span><strong><span>性能非常接近</span></strong><span>，但还没有接近100%的精度。从这里开始，我们可以尝试</span><strong><span>增大C</span></strong><span>或</span><strong><span>gamma</span></strong><span>来</span><strong><span>拟合</span></strong><span>更为</span><strong><span>复杂</span></strong><span>的模型</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span> = <span class="cm-variable">SVC</span>(<span class="cm-variable">C</span>=<span class="cm-number">1000</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svc</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.988</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.972</span><span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>在这个例子中，增大C可以显著改进模型，得到97.2%的精度</span></p></li></ul></li><li><p><strong><span>优点、缺点和参数</span></strong></p><ul><li><span>它在低维数据和高维数据（即很少特征和很多特征）上的表现都很好，但对样本个数的</span><strong><span>缩放表现不好</span></strong></li><li><span>SVM的另一个</span><strong><span>缺点</span></strong><span>是，</span><strong><span>预处理数据</span></strong><span>和</span><strong><span>调参</span></strong><span>都需要</span><strong><span>非常小心</span></strong><span>，所以很多应用都使用基于树的模型</span></li><li><span>此外，SVM模型</span><strong><span>很难检查</span></strong><span>（inspect），可能很难理解为什么会这么预测，而且也难以将模型向非专家进行解释</span></li><li><span>不过SVM仍然是值得尝试的，</span><strong><span>特别</span></strong><span>是所有特征的</span><strong><span>测量单位相似</span></strong><span>（比如都是</span><strong><span>像素密度</span></strong><span>）而且</span><strong><span>范围也差不多</span></strong><span>时</span></li><li><span>核SVM的</span><strong><span>重要参数</span></strong><span>是</span><strong><span>正则化参数C</span></strong><span>、</span><strong><span>核的选择</span></strong><span>以及与</span><strong><span>核相关的参数</span></strong></li><li><span>这里主要讲的是</span><strong><span>RBF核</span></strong><span>，RBF核</span><strong><span>只有一个</span></strong><span>参数</span><strong><span>gamma</span></strong><span>，它是</span><strong><span>高斯核宽度</span></strong><span>的</span><strong><span>倒数</span></strong></li><li><span>gamma和C控制的都是</span><strong><span>模型复杂度</span></strong><span>，</span><strong><span>较大的值</span></strong><span>都对应更为</span><strong><span>复杂</span></strong><span>的模型，因此，这两个参数的设定通常是</span><strong><span>强烈相关</span></strong><span>的，应该</span><strong><span>同时调节</span></strong></li></ul></li></ol><h4><a name="238-神经网络深度学习）neural-networks-deep-learning" class="md-header-anchor"></a><span>2.3.8 神经网络（深度学习）Neural Networks (Deep Learning)</span></h4><p><span>这里只讨论一些相对简单的方法，即用于分类和回归的</span><strong><span>多层感知机</span></strong><span>（multilayer perceptron，MLP），它可以作为研究更复杂的深度学习方法的起点。MLP也被称为（普通）</span><strong><span>前馈神经网络</span></strong><span>，有时也简称为</span><strong><span>神经网络</span></strong></p><h5><a name="1神经网络模型" class="md-header-anchor"></a><span>1.神经网络模型</span></h5><ul><li><p><span>MLP可以被视为</span><strong><span>广义的线性模型</span></strong><span>，执行</span><strong><span>多层处理</span></strong><span>后得到结论</span></p></li><li><p><span>线性回归的预测公式:</span></p><p><em><span>ŷ</span></em><span> = </span><em><span>w</span></em><span>[0] * </span><em><span>x</span></em><span>[0] + </span><em><span>w</span></em><span>[1] * </span><em><span>x</span></em><span>[1] + … </span><span>+</span><span> </span><em><span>w</span></em><span>[</span><em><span>p</span></em><span>] * </span><em><span>x</span></em><span>[</span><em><span>p</span></em><span>] + </span><em><span>b</span></em></p><p><span>ŷ是输入特征x[0]到x[p]的加权求和，权重为</span><strong><span>学到的系数</span></strong><span>(coefficients)w[0]到w[p]。</span></p><p><span>可以将这个公式</span><strong><span>可视化</span></strong><span>:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">display</span>(<span class="cm-variable">mglearn</span>.<span class="cm-property">plots</span>.<span class="cm-property">plot_logistic_regression_graph</span>())</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src=".\ML_COURSE\logistic regression visualization.png" style="zoom:50%;" /></p></li><li><p><span>在MLP中，</span><strong><span>多次重复这个计算加权求和</span></strong><span>的过程，首先计算代表</span><strong><span>中间过程</span></strong><span>的</span><strong><span>隐单元（hidden</span></strong><span> </span></p><p><strong><span>unit）</span></strong><span>，然后</span><strong><span>再计算这些隐单元的加权求和</span></strong><span>并得到最终结果(</span><strong><span>单隐层的多层感知机</span></strong><span>)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">display</span>(<span class="cm-variable">mglearn</span>.<span class="cm-property">plots</span>.<span class="cm-property">plot_single_hidden_layer_graph</span>())</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src=".\ML_COURSE\single hidden layer.png" style="zoom: 50%;" /></p><ul><li><p><span>在计算完每个</span><strong><span>隐单元的加权求和之后</span></strong><span>，</span><strong><span>对结果</span></strong><span>再应用一个</span><strong><span>非线性</span></strong><span>函数(</span><strong><span>激活函数</span></strong><span>（activation functios）)——通常是</span><strong><span>校正非线性</span></strong><span>（rectifying nonlinearity，也叫校正线性单元或</span><strong><span>relu</span></strong><span>）或</span><strong><span>正切双曲线</span></strong><span>（tangens hyperbolicus，</span><strong><span>tanh</span></strong><span>）。然后将这个函数的结果用于</span><strong><span>加权求和</span></strong><span>，计算得到输出ŷ</span></p></li><li><p><span>计算回归问题的ŷ的完整公式如下（使用tanh非线性）:</span></p><p><span>h[0] = tanh(w[0, 0] * x[0] + w[1, 0] * x[1] + w[2, 0] * x[2] + w[3, 0] * x[3] + b[0])</span></p><p><span>h[1] = tanh(w[0, 0] * x[0] + w[1, 0] * x[1] + w[2, 0] * x[2] + w[3, 0] * x[3] + b[1])</span></p><p><span>h[2] = tanh(w[0, 0] * x[0] + w[1, 0] * x[1] + w[2, 0] * x[2] + w[3, 0] * x[3] + b[2])</span></p><p><span>ŷ = v[0] * h[0] + v[1] * h[1] + v[2] * h[2] + b</span></p><p><span>其中，</span><strong><span>w</span></strong><span>是</span><strong><span>输入x与隐层h</span></strong><span>之间的</span><strong><span>权重</span></strong><span>，</span><strong><span>v</span></strong><span>是</span><strong><span>隐层h与输出ŷ</span></strong><span> 之间的</span><strong><span>权重</span></strong><span>。权重w和v要</span></p><p><span>从数据中</span><strong><span>学习得到</span></strong><span>，x是输入特征，ŷ 是计算得到的输出，h是计算的中间结果</span></p></li></ul></li><li><p><strong><span>多隐层的多层感知机--&gt;大型神经网络--&gt;深度学习</span></strong></p><p><img src=".\ML_COURSE\多隐层MLP.png" style="zoom:50%;" /></p></li></ul><h5><a name="2神经网络调参" class="md-header-anchor"></a><span>2.神经网络调参</span></h5><p><span>	</span><span>MLPClassifier应用到</span><strong><span>two_moons数据集</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">neural_network</span> <span class="cm-keyword">import</span> <span class="cm-variable">MLPClassifier</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">make_moons</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_moons</span>(<span class="cm-variable">n_samples</span>=<span class="cm-number">100</span>, <span class="cm-variable">noise</span>=<span class="cm-number">0.25</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X</span>, <span class="cm-variable">y</span>, <span class="cm-variable">stratify</span>=<span class="cm-variable">y</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">solver</span>=<span class="cm-string">'lbfgs'</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>).<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>) <span class="cm-comment">#solver='lbfgs'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-property">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">"Feature 0"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">"Feature 1"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 181px;"></div><div class="CodeMirror-gutters" style="display: none; height: 181px;"></div></div></div></pre><p><img src=".\ML_COURSE\MLP two_moons.png" style="zoom: 33%;" /></p><ul><li><p><span>包含</span><strong><span>100个隐单元</span></strong><span>的神经网络在two_moons数据集上学到的</span><strong><span>决策边界</span></strong></p><p><span>神经网络学到的决策边界完全是</span><strong><span>非线性</span></strong><span>(nonlinear)的，但</span><strong><span>相对平滑</span></strong><span>(relatively smooth)</span></p><p><strong><span>默认</span></strong><span>情况下，MLP使用100个隐结点，</span><strong><span>默认</span></strong><span>的非线性激活函数时</span><strong><span>relu</span></strong><span>，如果想得到</span><strong><span>更加平滑</span></strong><span>（模型</span><strong><span>更复杂</span></strong><span>）的决策边界，可以</span><strong><span>添加更多的隐单元</span></strong><span>、</span><strong><span>添加第二个隐层</span></strong><span>或者使用</span><strong><span>tanh 非线性</span></strong></p></li><li><p><span>减少hidden units数量（从而</span><strong><span>降低</span></strong><span>了</span><strong><span>模型复杂度</span></strong><span>）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 使用2个隐层，每个包含10个单元，这次使用tanh非线性</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">solver</span>=<span class="cm-string">'lbfgs'</span>, <span class="cm-variable">activation</span>=<span class="cm-string">'tanh'</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>, <span class="cm-variable">hidden_layer_sizes</span>=[<span class="cm-number">10</span>, <span class="cm-number">10</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mglearn</span>.<span class="cm-property">plots</span>.<span class="cm-property">plot_2d_separator</span>(<span class="cm-variable">mlp</span>, <span class="cm-variable">X_train</span>, <span class="cm-variable">fill</span>=<span class="cm-keyword">True</span>, <span class="cm-variable">alpha</span>=<span class="cm-number">.3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mglearn</span>.<span class="cm-property">discrete_scatter</span>(<span class="cm-variable">X_train</span>[:, <span class="cm-number">0</span>], <span class="cm-variable">X_train</span>[:, <span class="cm-number">1</span>], <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">"Feature 0"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">"Feature 1"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 181px;"></div><div class="CodeMirror-gutters" style="display: none; height: 181px;"></div></div></div></pre><p><span>				</span><span>包含2个隐层、每个隐层包含10个隐单元的神经网络学到的决策边界（激活函数为</span><strong><span>relu</span></strong><span>）</span></p><p><img src=".\ML_COURSE\relu.png" style="zoom: 33%;" /></p><p><span>			</span><span>  包含2个隐层、每个隐层包含10个隐单元的神经网络学到的决策边界（激活函数为</span><strong><span>tanh</span></strong><span>）</span></p><p><img src=".\ML_COURSE\tanh.png" style="zoom: 33%;" /></p></li><li><p><span>最后，我们还可以利用</span><strong><span>L2惩罚</span></strong><span>使</span><strong><span>权重趋向于0</span></strong><span>，从而控制神经网络的</span><strong><span>复杂度</span></strong><span>，正如我们在</span></p><p><strong><span>岭回归</span></strong><span>和</span><strong><span>线性分类器</span></strong><span>中所做的那样，MLPClassifier中调节L2惩罚的参数是</span><strong><span>alpha</span></strong><span>（与线</span></p><p><span>性回归模型中的</span><strong><span>相同</span></strong><span>），它的</span><strong><span>默认值很小</span></strong><span>（</span><strong><span>弱正则化</span></strong><span>）</span></p><p><strong><span>不同隐单元</span></strong><span>个数与</span><strong><span>alpha参数</span></strong><span>的</span><strong><span>不同</span></strong><span>设定下的决策函数：</span></p><p><img src=".\ML_COURSE\alpha n_hidden .png" style="zoom:50%;" /></p></li><li><p><span>神经网络的一个重要性质是，在开始学习之前其权重是</span><strong><span>随机</span></strong><span>设置的，这种随机初始化（随机种子不同）会</span><strong><span>影响</span></strong><span>（对于较小的网络）学到的模型</span></p></li><li><p><span>将MLPClassifier应用在乳腺癌数据集上</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.92</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.90</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>MLP的精度相当好，但没有其他模型好。与较早的SVC例子相同，原因可能在于数据的</span><strong><span>缩放</span></strong></p></li><li><p><strong><span>神经网络</span></strong><span>也要求所有输入特征的</span><strong><span>变化范围相似</span></strong><span>，最</span><strong><span>理想</span></strong><span>的情况是</span><strong><span>均值(mean)为0</span></strong><span>、</span><strong><span>方差(variance)为1</span></strong></p></li><li><p><span>此处手动完成缩放（第3章</span><strong><span>StandardScaler</span></strong><span>）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 计算训练集中每个特征的平均值</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mean_on_train</span> = <span class="cm-variable">X_train</span>.<span class="cm-property">mean</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 计算训练集中每个特征的标准差</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">std_on_train</span> = <span class="cm-variable">X_train</span>.<span class="cm-property">std</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 减去平均值，然后乘以标准差的倒数(除以标准差)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 如此运算之后，mean=0，std=1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = (<span class="cm-variable">X_train</span> <span class="cm-operator">-</span> <span class="cm-variable">mean_on_train</span>) <span class="cm-operator">/</span> <span class="cm-variable">std_on_train</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 对测试集做相同的变换（使用训练集的平均值和标准差）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = (<span class="cm-variable">X_test</span> <span class="cm-operator">-</span> <span class="cm-variable">mean_on_train</span>) <span class="cm-operator">/</span> <span class="cm-variable">std_on_train</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.991</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.965</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ConvergenceWarning</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Stochastic</span> <span class="cm-variable">Optimizer</span>: <span class="cm-variable">Maximum</span> <span class="cm-variable">iterations</span> <span class="cm-variable">reached</span> <span class="cm-keyword">and</span> <span class="cm-variable">the</span> <span class="cm-variable">optimization</span> <span class="cm-variable">hasn</span><span class="cm-string">'t <span class="cm-tab" role="presentation" cm-text="	">   </span> converged yet.</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>模型给出了一个警告，告诉我们已经达到最大迭代次数,应该增加迭代次数：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">max_iter</span>=<span class="cm-number">1000</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>) <span class="cm-comment"># max_iter=1000</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.995</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.965</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>增加迭代次数仅</span><strong><span>提高了训练集性能</span></strong><span>，但</span><strong><span>没有提高泛化性能</span></strong></p><p><span>由于训练性能和测试性能之间仍有一些差距，所以我们可以尝试</span><strong><span>降低模型复杂度</span></strong><span>来得到更</span><strong><span>好</span></strong></p><p><strong><span>的泛化性能</span></strong><span>。这里我们选择</span><strong><span>增大alpha参数</span></strong><span>（变化范围</span><strong><span>相当大</span></strong><span>，从</span><strong><span>0.0001到1</span></strong><span>），以此向</span></p><p><strong><span>权重</span></strong><span>添加</span><strong><span>更强的正则化</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span> = <span class="cm-variable">MLPClassifier</span>(<span class="cm-variable">max_iter</span>=<span class="cm-number">1000</span>, <span class="cm-variable">alpha</span>=<span class="cm-number">1</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mlp</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">training</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.988</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Accuracy</span> <span class="cm-variable">on</span> <span class="cm-variable">test</span> <span class="cm-builtin">set</span>: <span class="cm-number">0.972</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>这得到了与我们</span><strong><span>目前最好</span></strong><span>的模型相同的性能</span></p><p><span>虽然可以分析神经网络学到了什么，但这通常比分析线性模型或基于树的模型</span><strong><span>更为复杂</span></strong></p><p><span>观察神经网络在乳腺癌数据集上学到的第一个隐层权重的</span><strong><span>热图</span></strong><span>(heat map):</span></p><p><img src=".\ML_COURSE\heat map neural network.png" style="zoom:50%;" /></p></li></ul><p>&nbsp;</p></li></ul><h5><a name="3优点缺点和参数" class="md-header-anchor"></a><span>3.优点、缺点和参数</span></h5><ul><li><p><span>在机器学习的许多应用中，神经网络再次成为</span><strong><span>最先进</span></strong><span>的模型。它的</span><strong><span>主要优点之一</span></strong><span>是能够获</span></p><p><span>取大量数据中包含的信息，并构建</span><strong><span>无比复杂</span></strong><span>的模型。给定</span><strong><span>足够的计算时间和数据</span></strong><span>，并且</span><strong><span>仔</span></strong></p><p><strong><span>细调节（tuning）参数</span></strong><span>，神经网络</span><strong><span>通常可以打败</span></strong><span>其他机器学习算法（</span><strong><span>无论</span></strong><span>是</span><strong><span>分类任务</span></strong><span>还是</span><strong><span>回归任务</span></strong><span>）</span></p></li><li><p><strong><span>缺点</span></strong><span>:神经网络——特别是功能强大的大型神经网络——通常需要</span><strong><span>很长的训练时间</span></strong><span>,还需要仔细地</span><strong><span>预处理</span></strong><span>数据，</span></p><p><span>神经网络</span><strong><span>调参</span></strong><span>本身也是一门艺术（Tuning neural network parameters is also an art onto itself）</span></p></li><li><p><span>神经网络调参的</span><strong><span>常用方法</span></strong><span>是，首先创建一个</span><strong><span>大到足以过拟合</span></strong><span>的网络，确保这个网络可以对任务进行学习。知道训练数据可以被学习之后，要么</span><strong><span>缩小(shrink)网络</span></strong><span>，要么</span><strong><span>增大alpha</span></strong><span>来</span><strong><span>增强正则化</span></strong><span>，这可以</span><strong><span>提高泛化性能</span></strong></p></li><li><p><strong><span>solver参数</span></strong><span>设定：</span></p><ul><li><span>默认选项是</span><strong><span>&#39;adam&#39;</span></strong><span>，对数据的</span><strong><span>缩放</span></strong><span>相当</span><strong><span>敏感</span></strong><span>，始终将数据缩放为均值为0、方差为1（unit variance）是很重要的</span></li><li><span>另一个选项是</span><strong><span>&#39;l-bfgs&#39;</span></strong><span>，其</span><strong><span>鲁棒性</span></strong><span>相当好，但在大型模型或大型数据集上的</span><strong><span>时间会比较长</span></strong></li><li><span>更高级的</span><strong><span>&#39;sgd&#39;</span></strong><span>选项，许多深度学习研究人员都会用到</span></li><li><span>使用MLP时，建议使用&#39;adam&#39;和&#39;l-bfgs&#39;</span></li></ul></li></ul><h3><a name="24-分类器的不确定度估计-uncertainty-estimates-from-classifiers" class="md-header-anchor"></a><span>2.4 分类器的不确定度估计 Uncertainty Estimates from Classifiers</span></h3><p><span>scikit-learn接口的另一个有用之处，就是分类器能够给出预测的</span><strong><span>不确定度估计</span></strong><span>,不仅是分类器会预测一个测试点属于哪个类别，还包括它对这个预测的</span><strong><span>置信程度</span></strong><span>,scikit-learn中有两个函数可用于获取分类器的不确定度估计：</span><strong><span>decision_function</span></strong><span>（决策函数）和</span><strong><span>predict_proba</span></strong><span>（预测概率）</span></p><ul><li><span>构建一个GradientBoostingClassifier分类器（同时拥有decision_function和predict_proba两个方法）</span></li></ul><p><span>//TODO...</span></p><h4><a name="241-决策函数-decision-function" class="md-header-anchor"></a><span>2.4.1 决策函数 Decision Function</span></h4><h4><a name="242-预测概率-predicting-probabilities" class="md-header-anchor"></a><span>2.4.2 预测概率 Predicting Probabilities</span></h4><ul><li><p><span>predict_proba的输出是每个类别的概率，通常比decision_function的输出更容易理解。</span></p></li><li><p><strong><span>过拟合更强</span></strong><span>的模型可能会做出</span><strong><span>置信程度更高</span></strong><span>的预测，</span><strong><span>即使</span></strong><span>可能是</span><strong><span>错</span></strong><span>的。</span><strong><span>复杂度越低</span></strong><span>的模型通常对预测的</span><strong><span>不确定度越大</span></strong><span>。如果模型给出的不确定度</span><strong><span>符合实际情况</span></strong><span>，那么这个模型被称为</span><strong><span>校正（calibrated）模型</span></strong><span>。在校正模型</span></p><p><span>中，如果预测有70%的确定度，那么它在70%的情况下正确</span></p></li></ul><h4><a name="243-多分类问题的不确定度-uncertainty-in-multiclass-classification" class="md-header-anchor"></a><span>2.4.3 多分类问题的不确定度 Uncertainty in Multiclass Classification</span></h4><ul><li><span>将这两个函数应用于</span><strong><span>鸢尾花（Iris）数据集</span></strong><span>，这是一个</span><strong><span>三分类</span></strong><span>数据集</span></li><li><span>//TODO...</span></li></ul><h3><a name="25-小结与展望-summary-and-outlook" class="md-header-anchor"></a><span>2.5 小结与展望 Summary and Outlook</span></h3><p><span>关于何时使用哪种模型，下面是一份</span><strong><span>快速总结</span></strong><span>:</span></p><h4><a name="快速总结-由简单到复杂的模型）" class="md-header-anchor"></a><span>快速总结 （由简单到复杂的模型）</span></h4><h5><a name="1-最近邻-nearest-neighbors" class="md-header-anchor"></a><span>#1 最近邻 Nearest neighbors</span></h5><p><span>	</span><span>适用于</span><strong><span>小型数据集</span></strong><span>，是很好的基准（baseline）模型，很容易解释</span></p><h5><a name="2-线性模型-linear-models" class="md-header-anchor"></a><span>#2 线性模型 Linear models</span></h5><p><span>	</span><span>非常可靠的</span><strong><span>首选算法</span></strong><span>，适用于</span><strong><span>非常大的数据集</span></strong><span>，也适用于</span><strong><span>高维数据</span></strong><span>。</span></p><h5><a name="3-朴素贝叶斯-naive-bayes" class="md-header-anchor"></a><span>#3 朴素贝叶斯 Naive Bayes</span></h5><p><span>	</span><strong><span>只适用于分类问题</span></strong><span>。比线性模型速度还快，适用于</span><strong><span>非常大的数据集</span></strong><span>和</span><strong><span>高维数据</span></strong><span>。</span><strong><span>精度</span></strong><span>通</span></p><p><span>	</span><span>常要</span><strong><span>低于线性模型</span></strong><span>（less accurate）</span></p><h5><a name="4-决策树-decision-trees" class="md-header-anchor"></a><span>#4 决策树 Decision trees</span></h5><p><span>	</span><span>速度很</span><strong><span>快</span></strong><span>，</span><strong><span>不需要数据缩放</span></strong><span>，可以</span><strong><span>可视化</span></strong><span>，很</span><strong><span>容易解释</span></strong></p><h5><a name="5-随机森林-random-forests" class="md-header-anchor"></a><span>#5 随机森林 Random forests</span></h5><p><span>	</span><span>几乎总是</span><strong><span>比单棵</span></strong><span>决策树的表现要</span><strong><span>好</span></strong><span>，</span><strong><span>鲁棒性很好</span></strong><span>，非常</span><strong><span>强大</span></strong><span>。</span><strong><span>不需要数据缩放</span></strong><span>。</span><strong><span>不适用</span></strong></p><p><span>	</span><strong><span>于高维（high-dimensional）稀疏（sparse）数据</span></strong></p><h5><a name="6-梯度提升决策树-gradient-boosted-decision-trees" class="md-header-anchor"></a><span>#6 梯度提升决策树 Gradient boosted decision trees</span></h5><p><span>	</span><strong><span>精度</span></strong><span>通常</span><strong><span>比随机森林略高</span></strong><span>。与随机森林相比，</span><strong><span>训练</span></strong><span>速度</span><strong><span>更慢</span></strong><span>，但</span><strong><span>预测</span></strong><span>速度</span><strong><span>更快</span></strong><span>，需要的</span></p><p><span>	</span><strong><span>内存也更少</span></strong><span>。比随机森林需要</span><strong><span>更多的参数调节</span></strong></p><h5><a name="7-支持向量机-support-vector-machines" class="md-header-anchor"></a><span>#7 支持向量机 Support vector machines</span></h5><p><span>	</span><span>对于</span><strong><span>特征含义相似</span></strong><span>的</span><strong><span>中等</span></strong><span>大小的</span><strong><span>数据集</span></strong><span>很强大。</span><strong><span>需要数据缩放</span></strong><span>，</span><strong><span>对参数敏感</span></strong></p><h5><a name="8-神经网络-neural-networks" class="md-header-anchor"></a><span>#8 神经网络 Neural networks</span></h5><p><span>	</span><span>可以构建</span><strong><span>非常复杂</span></strong><span>的模型，</span><strong><span>特别</span></strong><span>是对于</span><strong><span>大型数据集</span></strong><span>而言。对</span><strong><span>数据缩放敏感</span></strong><span>，对</span><strong><span>参数选取敏感</span></strong><span>。</span></p><p><span>	</span><span>大型网络需要</span><strong><span>很长的训练时间</span></strong></p><h2><a name="chapter3-unsupervised-learning-and-preprocessing-无监督学习与预处理" class="md-header-anchor"></a><span>Chapter3 Unsupervised Learning and Preprocessing 无监督学习与预处理</span></h2><h3><a name="31-无监督学习的类型-types-of-unsupervised-learning" class="md-header-anchor"></a><span>3.1 无监督学习的类型 Types of unsupervised learning</span></h3><p><span>本章将研究</span><strong><span>两种</span></strong><span>类型的无监督学习：</span><strong><span>数据集变换</span></strong><span>与</span><strong><span>聚类</span></strong></p><ul><li><p><strong><span>无监督变换（unsupervised transformation）</span></strong></p><ul><li><span>常见</span><strong><span>应用</span></strong><span>：</span><strong><span>降维（dimensionality reduction）</span></strong></li><li><span>另一个</span><strong><span>应用</span></strong><span>是找到“构成”数据的各个组成部分（例子：对文本文档集合进行主题提取）</span></li></ul></li><li><p><strong><span>聚类算法（clustering algorithm）</span></strong></p><ul><li><span>将数据划分成</span><strong><span>不同的组</span></strong><span>，每组包含</span><strong><span>相似的物项</span></strong></li></ul></li></ul><h3><a name="32-无监督学习的挑战-challenges-in-unsupervised-learning" class="md-header-anchor"></a><span>3.2 无监督学习的挑战 Challenges in unsupervised learning</span></h3><ul><li><strong><span>主要挑战</span></strong><span>就是评估算法是否学到了有用的东西，无监督学习算法一般用于</span><strong><span>不包含任何标签</span></strong><span>信息的数据，所以</span><strong><span>不知道</span></strong><span>正确的</span><strong><span>输出</span></strong><span>应该是什么。因此很难判断一个模型是否“表现很好”。</span></li><li><span>通常来说，</span><strong><span>评估无监督算法结果</span></strong><span>的</span><strong><span>唯一</span></strong><span>方法就是</span><strong><span>人工检查</span></strong><span>（manually）</span></li><li><span>无监督算法通常可用于</span><strong><span>探索性</span></strong><span>的目的，而不是作为大型自动化系统的一部分</span></li><li><span>无监督算法的另一个</span><strong><span>常见应用</span></strong><span>是</span><strong><span>作为监督算法</span></strong><span>的</span><strong><span>预处理步骤</span></strong></li></ul><h3><a name="33-预处理与缩放-preprocessing-and-scaling" class="md-header-anchor"></a><span>3.3 预处理与缩放 Preprocessing and Scaling</span></h3><h4><a name="331-不同类型的预处理-diferent-kinds-of-preprocessing" class="md-header-anchor"></a><span>3.3.1 不同类型的预处理 Diferent kinds of preprocessing</span></h4><ul><li><p><span>StandardScaler：确保每个特征的</span><strong><span>平均值（mean）为0</span></strong><span>、</span><strong><span>方差(variance)为1</span></strong><span>，使所有特征都位于同一量</span></p><p><span>级，但</span><strong><span>不能保证</span></strong><span>特征任何特定的</span><strong><span>最大值</span></strong><span>和</span><strong><span>最小值</span></strong></p></li><li><p><span>RobustScaler：工作原理与StandardScaler类似，使用</span><strong><span>中位数</span></strong><span>和</span><strong><span>四分位数</span></strong><span>。这样RobustScaler会忽略与其他点有很大不同的数据点（比如</span><strong><span>测量误差</span></strong><span>）。这些与众不同的数据点也叫</span><strong><span>异常值（outlier）</span></strong></p></li><li><p><span>MinMaxScaler：</span><strong><span>移动</span></strong><span>数据，使所有特征都刚好位于0到1之间</span></p></li><li><p><span>Normalizer：用到一种完全不同的缩放方法，使得特征向量的</span><strong><span>欧式长度等于1</span></strong><span>。每个数据点的缩放比例都</span><strong><span>不相同</span></strong><span>（乘以其长度的倒数）。如果只有</span><strong><span>数据的方向（或角度）</span></strong><span>是</span><strong><span>重要</span></strong><span>的，而</span><strong><span>特征向量的长度无关紧要</span></strong><span>，那么通常会使用这种</span><strong><span>归一化</span></strong><span>（据点投射到半径为</span><strong><span>1</span></strong><span>的圆上（对于更高维度的情况，是球面））。</span></p></li><li><p><strong><span>对比图</span></strong></p><p><img src=".\ML_COURSE\different Scaler.png" style="zoom: 50%;" /></p></li></ul><h4><a name="332-应用数据变换-applying-data-transformations" class="md-header-anchor"></a><span>3.3.2 应用数据变换 Applying data transformations</span></h4><ul><li><p><span>将核</span><strong><span>SVM</span></strong><span>（SVC）应用在</span><strong><span>cancer</span></strong><span>数据集上，并使用</span><strong><span>MinMaxScaler</span></strong><span>来预处理数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">MinMaxScaler</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">MinMaxScaler</span>() <span class="cm-comment"># MinMaxScaler</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>) <span class="cm-comment">#X_train</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">MinMaxScaler</span>(<span class="cm-variable">copy</span>=<span class="cm-keyword">True</span>, <span class="cm-variable">feature_range</span>=(<span class="cm-number">0</span>, <span class="cm-number">1</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 变换数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_train</span>) <span class="cm-comment">#transform</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 在缩放之前和之后分别打印数据集属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"transformed shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">shape</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum before scaling:\n {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum before scaling:\n {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum after scaling:\n {}"</span>.<span class="cm-property">format</span>( &nbsp; &nbsp;<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum after scaling:\n {}"</span>.<span class="cm-property">format</span>( &nbsp; &nbsp;<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 227px;"></div><div class="CodeMirror-gutters" style="display: none; height: 227px;"></div></div></div></pre><p><span>对</span><strong><span>测试集</span></strong><span>进行变换:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 对测试数据进行变换</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 在缩放之后打印测试数据的属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...<span class="cm-property">min</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...<span class="cm-property">max</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><img src=".\ML_COURSE\negative_scaled.png" style="zoom:50%;" /></p><p><span>对测试集缩放后的最大值和最小值不是1和0，因为MinMaxScaler（以及其他所有缩放器）总是</span></p><p><span>对训练集和测试集应用</span><strong><span>完全相同的变换</span></strong><span>。也就是说，</span><strong><span>transform</span></strong><span>方法总是减去</span><strong><span>训练集</span></strong><span>的最小值，然后除以</span><strong><span>训练集</span></strong><span>的范围，而这两个值可能与测试集的最小值和范围并</span><strong><span>不相同</span></strong></p></li></ul><h4><a name="333-对训练数据和测试数据进行相同的缩放-scaling-training-and-test-data-the-same-way" class="md-header-anchor"></a><span>3.3.3 对训练数据和测试数据进行相同的缩放 Scaling training and test data the same way</span></h4><p><span>对训练集和测试集</span><strong><span>分别</span></strong><span>缩放：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_scaler</span> = <span class="cm-variable">MinMaxScaler</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">test_scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled_badly</span> = <span class="cm-variable">test_scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>所有具有transform</span></strong><span>方法的模型也都具有一个</span><strong><span>fit_transform</span></strong><span>方法：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">StandardScaler</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">StandardScaler</span>() <span class="cm-comment"># StandardScaler</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 依次调用fit和transform（使用方法链）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X</span>).<span class="cm-property">transform</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 结果相同，但计算更加高效</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_scaled_d</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">X</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><h4><a name="334-预处理对监督学习的作用-the-efect-of-preprocessing-on-supervised-learning" class="md-header-anchor"></a><span>3.3.4 预处理对监督学习的作用 The efect of preprocessing on supervised learning</span></h4><ul><li><p><strong><span>观察使用MinMaxScaler对学习SVC的作用（缩放前后对比）</span></strong></p></li><li><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">svm</span> <span class="cm-keyword">import</span> <span class="cm-variable">SVC</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">cancer</span>.<span class="cm-property">data</span>, <span class="cm-variable">cancer</span>.<span class="cm-property">target</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span> = <span class="cm-variable">SVC</span>(<span class="cm-variable">C</span>=<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">svm</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">0.629370629371</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li><li><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># preprocessing using 0-1 scaling 使用0-1缩放进行预处理</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">MinMaxScaler</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>) <span class="cm-comment">#X_train</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>) <span class="cm-comment"># 使用训练集transform测试集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># learning an SVM on the scaled training data 在缩放数据上学习SVM</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># scoring on the scaled test set 在缩放的测试集上计算分数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test_scaled</span>, <span class="cm-variable">y_test</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 204px;"></div><div class="CodeMirror-gutters" style="display: none; height: 204px;"></div></div></div></pre></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">0.965034965034965</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># preprocessing using zero mean and unit variance scaling 利用零均值和单位方差的缩放方法进行预处理</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">StandardScaler</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">StandardScaler</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># learning an SVM on the scaled training data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># scoring on the scaled test set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svm</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test_scaled</span>, <span class="cm-variable">y_test</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 249px;"></div><div class="CodeMirror-gutters" style="display: none; height: 249px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">0.95804195804195802</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li></ul><h3><a name="34降维特征提取与流形学习-dimensionality-reduction-feature-extraction-and-manifold-learning" class="md-header-anchor"></a><span>3.4　降维、特征提取与流形学习 Dimensionality Reduction, Feature Extraction and Manifold Learning </span></h3><p><span>利用无监督学习进行数据变换可能有很多种目的。最常见的目的就是可视化、压缩数据，以及寻找信息量更大的数据表示以用于进一步的处理。为了实现这些目的，最简单也最常用的一种算法就是</span><strong><span>主成分分析</span></strong><span>。以及另外两种算法：</span><strong><span>非负矩阵分解（NMF）</span></strong><span>和</span><strong><span>t-SNE</span></strong><span>，前者通常用于</span><strong><span>特征提取</span></strong><span>，后者通常用于</span><strong><span>二维散点图的可视化</span></strong></p><h4><a name="341主成分分析-principal-component-analysis-pca" class="md-header-anchor"></a><span>3.4.1　主成分分析 Principal Component Analysis (PCA)</span></h4><p><span>主成分分析（PCA）是一种</span><strong><span>旋转数据集</span></strong><span>的方法，旋转后的特征在</span><strong><span>统计上不相关</span></strong><span>，在做完这种旋转之后，通常是根据</span><strong><span>新特征</span></strong><span>对</span><strong><span>解释数据的重要性</span></strong><span>来</span><strong><span>选择</span></strong><span>它的一个</span><strong><span>子集</span></strong></p><ul><li><p><span>PCA对一个</span><strong><span>模拟二维数据集</span></strong><span>的作用：</span></p><p><code>mglearn.plots.plot_pca_illustration()</code></p><p><img src=".\ML_COURSE\pca illustration.png" style="zoom:50%;" /></p><ul><li><p><strong><span>第一张图</span></strong><span>（左上）显示的是原始数据点，用不同颜色加以区分。算法首先找到</span><strong><span>方差最大</span></strong><span>的</span></p><p><strong><span>方向</span></strong><span>，将其标记为“</span><strong><span>成分1</span></strong><span>”（Component 1）。这是数据中</span><strong><span>包含最多信息</span></strong><span>的</span><strong><span>方向（或向量）</span></strong><span>，</span></p><p><span>换句话说，沿着这个方向的</span><strong><span>特征之间最为相关</span></strong></p></li><li><p><span>然后，算法找到与第一个方向</span><strong><span>正交</span></strong><span>（成直角）且包</span><strong><span>含最多信息</span></strong><span>的方向。在</span><strong><span>二维</span></strong><span>空间中，只有</span><strong><span>一个</span></strong><span>成直角的方向，但在</span><strong><span>更高维</span></strong><span>的空间中会有</span><strong><span>（无穷）多</span></strong><span>的正交方向</span></p></li><li><p><span>虽然这两个成分都画成箭头，但其头尾的位置并不重要</span></p></li><li><p><span>利用这一过程找到的</span><strong><span>方向</span></strong><span>被称为</span><strong><span>主成分</span></strong><span>（principal component），因为它们是</span><strong><span>数据方差的主要方向</span></strong><span>。一般来说，</span><strong><span>主成分的个数与原始特征相同</span></strong></p></li><li><p><strong><span>第二张图</span></strong><span>旋转，使得第一主成分与x轴平行且第二主成分与y轴平行</span></p></li><li><p><span>在旋转之前，从数据中</span><strong><span>减去平均值</span></strong><span>，使得变换后的数据</span><strong><span>以零为中心</span></strong></p></li><li><p><span>在PCA找到的旋转表示中，两个</span><strong><span>坐标轴</span></strong><span>是</span><strong><span>不相关</span></strong><span>的，也就是说，对于这种数据表示，</span></p><p><strong><span>除了对角线，相关矩阵全部为零</span></strong></p></li><li><p><strong><span>第三张图</span></strong><span>通过仅保留</span><strong><span>一部分主成分</span></strong><span>来使用PCA进行</span><strong><span>降维</span></strong></p></li><li><p><span>最后，我们可以</span><strong><span>反向旋转</span></strong><span>（undo the rotation）并将</span><strong><span>平均值重新加到数据中</span></strong><span>，得到</span><strong><span>最后一张图</span></strong><span>中的数据，这些数据中仅保留了</span><strong><span>第一主成分</span></strong><span>中包含的信息。</span></p><p><span>这种变换有时用于</span><strong><span>去除</span></strong><span>数据中的</span><strong><span>噪声</span></strong><span>影响，或者将</span><strong><span>主成分</span></strong><span>中保留的那部分信息</span><strong><span>可视化</span></strong></p></li></ul></li></ul><h5><a name="1将pca应用于cancer数据集并可视化" class="md-header-anchor"></a><span>1.将PCA应用于cancer数据集并可视化</span></h5><p><span>PCA最常见的应用之一就是将</span><strong><span>高维数据集可视化</span></strong><span>，对于有两个以上特征的数据，很难绘制散点图，所以可以使用一种更简单的可视化方法——对</span><strong><span>每个特征</span></strong><span>分别</span><strong><span>计算两个类别</span></strong><span>（良性肿瘤和恶性肿瘤）的</span><strong><span>直方图</span></strong></p><p><img src=".\ML_COURSE\pca cancer.png" style="zoom:60%;" /></p><ul><li><p><span>为每个特征创建一个直方图，计算具有某一特征的数据点在</span><strong><span>特定范围内</span></strong><span>（叫作</span><strong><span>bin</span></strong><span>）的</span><strong><span>出现频率</span></strong><span>。每张图都包含两个直方图，一个是良性类别的所有点（蓝色），一个是恶性类别的所有点（红色）。这样我们可以了解每个特征在</span><strong><span>两个类别中</span></strong><span>的</span><strong><span>分布情况</span></strong><span>，也可以猜测</span><strong><span>哪些特征</span></strong><span>能够</span><strong><span>更好</span></strong><span>地</span><strong><span>区分</span></strong><span>良性样本和恶性样本</span></p></li><li><p><span>利用PCA，我们可以获取到主要的</span><strong><span>相互作用</span></strong><span>，并得到稍为完整的图像。我们可以找到前两个主成分，并在这个新的二维空间中用</span><strong><span>散点图</span></strong><span>将数据可视化</span></p><p><span>在应用PCA之前，利用StandardScaler缩放数据，使每个特征的方差均为1:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># StandardScaler</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">StandardScaler</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">cancer</span>.<span class="cm-property">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">cancer</span>.<span class="cm-property">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">decomposition</span> <span class="cm-keyword">import</span> <span class="cm-variable">PCA</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 保留数据的前两个主成分</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span> = <span class="cm-variable">PCA</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 对乳腺癌数据拟合PCA模型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_scaled</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 将数据变换到前两个主成分的方向上</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_pca</span> = <span class="cm-variable">pca</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_scaled</span>) <span class="cm-comment"># pca.transform(X_scaled)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Original shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-builtin">str</span>(<span class="cm-variable">X_scaled</span>.<span class="cm-property">shape</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Reduced shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-builtin">str</span>(<span class="cm-variable">X_pca</span>.<span class="cm-property">shape</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Original</span> <span class="cm-variable">shape</span>: (<span class="cm-number">569</span>, <span class="cm-number">30</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Reduced</span> <span class="cm-variable">shape</span>: (<span class="cm-number">569</span>, <span class="cm-number">2</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>对前两个主成分作图:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-property">mglearn</span>.<span class="cm-property">discrete_scatter</span>(<span class="cm-variable">X_pca</span>[:, <span class="cm-number">0</span>], <span class="cm-variable">X_pca</span>[:, <span class="cm-number">1</span>], <span class="cm-variable">cancer</span>.<span class="cm-property">target</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>												</span><span>利用</span><strong><span>前两个主成分</span></strong><span>绘制乳腺癌数据集的二维散点图:</span></p><p><img src=".\ML_COURSE\pca cancer scatter.png" style="zoom:50%;" /></p><ul><li><p><span>重要的是要注意，PCA是一种</span><strong><span>无监督</span></strong><span>方法，在寻找旋转方向时</span><strong><span>没有用到任何类别信息</span></strong><span>。它</span></p><p><span>只是</span><strong><span>观察</span></strong><span>数据中的</span><strong><span>相关性</span></strong></p></li><li><p><span>PCA的一个</span><strong><span>缺点</span></strong><span>（downside）在于，通常不容易对图中的两个轴做出解释（interpret）</span></p></li><li><p><span>在拟合过程中，主成分被保存在PCA对象的</span><strong><span>components_属性</span></strong><span>中：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"PCA component shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">pca</span>.<span class="cm-property">components_</span>.<span class="cm-property">shape</span>))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PCA</span> <span class="cm-variable">component</span> <span class="cm-variable">shape</span>: (<span class="cm-number">2</span>, <span class="cm-number">30</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li><li><p><span>components_中的每一</span><strong><span>行</span></strong><span>对应于一个</span><strong><span>主成分</span></strong><span>，它们按重要性排序（第一主成分排在首位，以此类推），</span><strong><span>列</span></strong><span>对应于PCA的</span><strong><span>原始特征属性</span></strong></p></li><li><p><span>可以用</span><strong><span>热图</span></strong><span>（heatmap）将系数可视化：</span></p><p><img src=".\ML_COURSE\pca cancer heatmap.png" style="zoom: 67%;" /></p><ul><li><p><span>在第一个主成分中，所有特征的符号相同（均为</span><strong><span>正</span></strong><span>，但前面提到过，箭头指向哪个方向无关紧要）,</span></p><p><span>这意味着在所有特征之间存在普遍的</span><strong><span>相关性</span></strong><span>（如果一个测量值较大的话，其他的测量值可能也较大）</span></p></li><li><p><span>第二个主成分的符号</span><strong><span>有正有负</span></strong></p></li><li><p><span>而且两个主成分都包含</span><strong><span>所有30个特征</span></strong></p></li></ul></li></ul></li></ul><h5><a name="2特征提取的特征脸-eigenfaces-for-feature-extraction" class="md-header-anchor"></a><span>2.特征提取的特征脸 Eigenfaces for feature extraction</span></h5><p><span>PCA的另一个应用是</span><strong><span>特征提取</span></strong><span>，特征提取背后的思想是，可以</span><strong><span>找到一种数据表示</span></strong><span>，比给定的原始表示</span><strong><span>更适合于分析</span></strong><span>。它的一个很好的应用实例就是</span><strong><span>图像</span></strong></p><ul><li><p><span>给出用PCA对图像做特征提取的一个简单应用，即处理</span><strong><span>Wild数据集Labeled Faces</span></strong><span>（标记人脸）中的人脸图像</span></p></li><li><p><span>//TODO...见书</span></p></li><li><p><span>对PCA变换的介绍是：</span><strong><span>先旋转数据，然后删除方差较小的成分</span></strong></p></li><li><p><strong><span>另一种</span></strong><span>有用的解释是尝试找到一些</span><strong><span>数字</span></strong><span>（</span><strong><span>PCA旋转后的新特征值</span></strong><span>），使我们可以将测试点表示为</span><strong><span>主成分</span></strong><span>的</span><strong><span>加权求和</span></strong></p></li><li><p><span>图解PCA(Schematic view of PCA)：将图像分解(decomposing)为成分的加权求和:</span></p><p><img src=".\ML_COURSE\face decomposition.png" style="zoom:50%;" /></p><p><span>这里x0、x1等是这个数据点的</span><strong><span>主成分的系数</span></strong><span>，换句话说，它们是图像在</span><strong><span>旋转后</span></strong><span>的</span><strong><span>空间中的表示</span></strong><span>(representation of the image in the rotated space)</span></p></li><li><p><span>另一种方法来理解PCA模型，就是仅使用一些成分对原始数据进行</span><strong><span>重建</span></strong></p><ul><li><p><span>反向旋转并重新加上平均值</span></p></li><li><p><span>可以对人脸做类似的变换，将数据降维到只包含一些主成分，然后反向旋转回到原始空间。回到</span></p><p><strong><span>原始特征空间</span></strong><span>可以通过inverse_transform方法来实现</span></p></li></ul></li><li><p><span>随着使用的</span><strong><span>主成分越来越多</span></strong><span>，图像中也保留（preserved）了越来越多的</span><strong><span>细节</span></strong><span>，相当于把图分解式的求和中包含</span><strong><span>越来越多的项</span></strong><span>（extending the sum in Figure decomposition to include more and more terms）</span></p></li><li><p><span>与cancer类似，尝试使用PCA的</span><strong><span>前两个主成分</span></strong><span>，将数据集中的所有人脸在</span><strong><span>散点图</span></strong><span>中可视化</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># mglearn.discrete_scatter(X_pca[:, 0], X_pca[:, 1], cancer.target)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mglearn</span>.<span class="cm-property">discrete_scatter</span>(<span class="cm-variable">X_train_pca</span>[:, <span class="cm-number">0</span>], <span class="cm-variable">X_train_pca</span>[:, <span class="cm-number">1</span>], <span class="cm-variable">y_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><img src=".\ML_COURSE\face scatter plot pca.png" style="zoom:50%;" /></p><p><span>如果只使用前两个主成分，整个数据只是一大团，看不到类别之间的分界，说明PCA只能捕捉到人脸非常粗略的特征</span></p></li></ul><h4><a name="342非负矩阵分解-non-negative-matrix-factorization-nmf" class="md-header-anchor"></a><span>3.4.2　非负矩阵分解 Non-Negative Matrix Factorization (NMF)</span></h4><p><span>非负矩阵分解（non-negative matrix factorization，NMF）是另一种无监督学习算法，其目的在于</span><strong><span>提取有用的特征</span></strong><span>。它的</span><strong><span>工作原理类似于PCA</span></strong><span>，</span><strong><span>也可以</span></strong><span>用于</span><strong><span>降维</span></strong><span>。</span><strong><span>与PCA相同</span></strong><span>，试图将每个数据点写成一些</span><strong><span>分量的加权求和</span></strong></p><ul><li><p><span>在</span><strong><span>PCA</span></strong><span>中，想要的是</span><strong><span>正交分量</span></strong><span>，并且能够解释</span><strong><span>尽可能多</span></strong><span>的</span><strong><span>数据方差</span></strong></p></li><li><p><span>而在</span><strong><span>NMF</span></strong><span>中，希望</span><strong><span>分量和系数均为非负</span></strong><span>，也就是说，我们希望分量和系数都大于或等于0。因此，这种方法</span><strong><span>只能</span></strong><span>应用于</span><strong><span>每个特征</span></strong><span>都是</span><strong><span>非负</span></strong><span>的数据，因为非负分量的非负求和</span><strong><span>不可能</span></strong><span>变为负值</span></p></li><li><p><span>将数据分解成非负加权求和的这个过程，对由</span><strong><span>多个独立源</span></strong><span>相加（或叠加）创建而成的数据特别有用</span></p><p><span>（比如：识别出组成合成数据（多人说话的音轨或包含多种乐器的音乐）的</span><strong><span>原始分量</span></strong><span>）</span></p></li><li><p><span>与PCA相比，NMF得到的分量</span><strong><span>更容易解释</span></strong><span>，因为</span><strong><span>负</span></strong><span>的分量和系数可能会导致难以解释的</span><strong><span>抵消效应</span></strong><span>（cancellation effect）</span></p></li></ul><h5><a name="1将nmf应用于模拟数据" class="md-header-anchor"></a><span>1.将NMF应用于模拟数据</span></h5><ul><li><p><span>NMF能够</span><strong><span>对数据进行操作</span></strong><span>。这说明数据相对于原点</span><strong><span>(0, 0)</span></strong><span>的位置实际上对NMF很重要</span></p></li><li><p><span>可以将提取出来的非负分量看作是从(0, 0)到数据的</span><strong><span>方向</span></strong><span>（类似于向量）</span></p></li><li><p><strong><span>两个分量</span></strong><span>的非负矩阵分解（左）和</span><strong><span>一个分量</span></strong><span>的非负矩阵分解（右）找到的分量：</span></p><p><img src=".\ML_COURSE\one &amp; two components NMF.png" style="zoom:50%;" /></p></li><li><p><span>所有数据点都可以写成这两个分量的正数组合。如果有</span><strong><span>足够多</span></strong><span>的分量能够</span><strong><span>完美地重建</span></strong><span>数据（</span><strong><span>分量个数与特征个数相同</span></strong><span>），那么算法会选择指向</span><strong><span>数据极值</span></strong><span>的方向</span></p></li><li><p><span>如果仅使用</span><strong><span>一个分量</span></strong><span>，那么NMF会创建一个</span><strong><span>指向平均值</span></strong><span>的分量</span></p></li><li><p><strong><span>与PCA不同</span></strong><span>，减少分量个数不仅会</span><strong><span>删除一些方向</span></strong><span>，而且会</span><strong><span>创建</span></strong><span>一组</span><strong><span>完全不同的分量</span></strong></p></li><li><p><span>NMF的分量也</span><strong><span>没有</span></strong><span>按任何特定方法</span><strong><span>排序</span></strong><span>，所以不存在“第一非负分量”：</span><strong><span>所有分量</span></strong><span>的</span><strong><span>地位平等</span></strong></p></li><li><p><span>NMF使用了</span><strong><span>随机初始化</span></strong><span>，根据随机种子的不同可能会产生不同的结果，在复杂情况下，随机影响可能会很大</span></p></li></ul><h5><a name="2将nmf应用于人脸图像" class="md-header-anchor"></a><span>2.将NMF应用于人脸图像</span></h5><p><span>NMF的</span><strong><span>主要参数</span></strong><span>是需要提取的</span><strong><span>分量个数</span></strong><span>，要</span><strong><span>小于</span></strong><span>输入特征的个数，否则针对每个像素点都成为了单独的分量</span></p><ul><li><span>观察</span><strong><span>分量个数</span></strong><span>如何影响NMF</span><strong><span>重建</span></strong><span>（restruct）数据的好坏：反向变换的数据质量与使用PCA时类似，但要</span><strong><span>稍差</span></strong><span>一些。这是符合预期的，因为</span><strong><span>PCA</span></strong><span>找到的是</span><strong><span>重建</span></strong><span>的</span><strong><span>最佳方向</span></strong><span>(optimum directions)，</span><strong><span>NMF</span></strong><span>通常</span><strong><span>并不用于</span></strong><span>对数据进行重建或编码，而是用于在数据中寻找有趣的模式（rather for finding interesting patterns within the data）</span></li><li><span>由于</span><strong><span>分量</span></strong><span>都是</span><strong><span>正</span></strong><span>的，因此比PCA分量</span><strong><span>更像</span></strong><span>人脸原型</span></li><li><span>分量系数（coefficient）较大的人脸更加清晰</span></li></ul><p><span>提取这样的模式</span><strong><span>最适合于</span></strong><span>具有</span><strong><span>叠加结构</span></strong><span>的数据，包括</span><strong><span>音频、基因表达和文本数据</span></strong></p><ul><li><p><span>假设有100台装置测量一个由三个不同信号源合成的信号：</span></p><p><span>代码见书 P125 </span></p></li><li><p><span>使用NMF来还原这三个信号：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nmf</span> = <span class="cm-variable">NMF</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">3</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">S_</span> = <span class="cm-variable">nmf</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Recovered signal shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">S_</span>.<span class="cm-property">shape</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Recovered</span> <span class="cm-variable">signal</span> <span class="cm-variable">shape</span>: (<span class="cm-number">2000</span>, <span class="cm-number">3</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>为了</span><strong><span>对比</span></strong><span>，也应用了</span><strong><span>PCA</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span> = <span class="cm-variable">PCA</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">3</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">H</span> = <span class="cm-variable">pca</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">X</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>...</span></p><p><span>															</span><span>利用NMF和PCA</span><strong><span>还原</span></strong><span>混合信号源:</span></p><p><img src=".\ML_COURSE\recover mixed nmf pca.png" style="zoom:50%;" /></p><p><span>NMF在发现原始信号源时得到了不错的结果，而PCA则失败了</span></p><ul><li><p><span>要记住，NMF生成的分量是</span><strong><span>没有顺序</span></strong><span>的，在这个例子中，NMF分量的顺序与原始信号完</span></p><p><span>全相同（参见三条曲线的颜色），但这</span><strong><span>纯属偶然</span></strong></p></li></ul></li></ul><h4><a name="343用t-sne进行流形学习--manifold-learning-with-t-sne" class="md-header-anchor"></a><span>3.4.3　用t-SNE进行流形学习  Manifold learning with t-SNE</span></h4><ul><li><p><span>虽然PCA通常是用于变换数据的首选方法，使你能够用</span><strong><span>散点图</span></strong><span>将其可视化，但这一方法的性质（</span><strong><span>先旋转然后减少方向</span></strong><span>）</span><strong><span>限制了其有效性</span></strong><span>，有一类用于可视化的算法叫作</span><strong><span>流形学习算法</span></strong><span>（</span><strong><span>manifold learning</span></strong><span> algorithm），它允许进行更复杂的映射，通常也可以给出</span><strong><span>更好的可视化</span></strong><span>。其中特别有用的一个就是</span><strong><span>t-SNE算法</span></strong></p></li><li><p><span>流形学习算法主要用于可视化，因此很少用来生成两个以上的新特征</span></p></li><li><p><span>其中的算法计算</span><strong><span>训练数据</span></strong><span>的一种</span><strong><span>新表示</span></strong><span>，但</span><strong><span>不允许变换新数据</span></strong><span>，这意味着这些算法</span><strong><span>不能用于测试集</span></strong><span>：更确切地说，它们</span><strong><span>只能变换</span></strong><span>用于</span><strong><span>训练</span></strong><span>的数据，流形学习对</span><strong><span>探索性数据分析</span></strong><span>是很有用的</span></p></li><li><p><strong><span>t-SNE</span></strong><span>背后的思想是找到数据的一个</span><strong><span>二维表示</span></strong><span>，尽可能地</span><strong><span>保持</span></strong><span>数据点之间的</span><strong><span>距离</span></strong></p></li><li><p><span>对scikit-learn包含的一个</span><strong><span>手写数字数据集</span></strong><span>应用t-SNE流形学习算法：</span></p><ul><li><p><span>使用</span><strong><span>PCA</span></strong><span>对前两个主成分作图：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 构建一个PCA模型</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span> = <span class="cm-variable">PCA</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span>.<span class="cm-property">fit</span>(<span class="cm-variable">digits</span>.<span class="cm-property">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 将digits数据变换到前两个主成分的方向上</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">digits_pca</span> = <span class="cm-variable">pca</span>.<span class="cm-property">transform</span>(<span class="cm-variable">digits</span>.<span class="cm-property">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><p><span>...</span><img/></p><p><span>大部分其他数字都大量</span><strong><span>重叠</span></strong><span>在一起</span></p></li><li><p><span>将</span><strong><span>t-SNE</span></strong><span>应用于同一个数据集，并对结果进行比较:</span></p><p><span>由于t-SNE</span><strong><span>不支持变换新数据</span></strong><span>，所以TSNE类</span><strong><span>没有transform</span></strong><span>方法。我们可以调用</span><strong><span>fit_transform</span></strong><span>方法来代替（构建模型并立刻返回变换后的数据）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">manifold</span> <span class="cm-keyword">import</span> <span class="cm-variable">TSNE</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tsne</span> = <span class="cm-variable">TSNE</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 使用fit_transform而不是fit，因为TSNE没有transform方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">digits_tsne</span> = <span class="cm-variable">tsne</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">digits</span>.<span class="cm-property">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>利用</span><strong><span>t-SNE</span></strong><span>找到的两个分量绘制</span><strong><span>digits数据集</span></strong><span>的</span><strong><span>散点图</span></strong><span>:</span></p><p><img src=".\ML_COURSE\t-sne digits scatter.png" style="zoom:50%;" /></p><ul><li><p><span>数字1和9被分成几块，但大多数类别都形成一个</span><strong><span>密集的组</span></strong><span>。</span></p></li><li><p><strong><span>要记住</span></strong><span>，这种方法</span><strong><span>并不知道类别标签</span></strong><span>：它完全是</span><strong><span>无监督</span></strong><span>的</span></p></li><li><p><span>但它能够找到数据的一种二维表示，仅根据原始空间中</span><strong><span>数据点</span></strong><span>之间的</span><strong><span>靠近程度</span></strong><span>就能够将各个类别明</span></p><p><span>确分开</span></p></li><li><p><span>可尝试修改perplexity和early_exaggeration的调节参数，但作用一般很小</span></p></li></ul></li></ul></li></ul><h3><a name="35--聚类-clustering" class="md-header-anchor"></a><span>3.5  聚类 Clustering</span></h3><p><span>聚类（clustering）是将数据集划分成组的任务，这些组叫作簇（cluster）,其目标是划分数据，使得</span><strong><span>一个簇内的数据点非常相似且不同簇内的数据点非常不同</span></strong><span>，聚类算法为每个数据点分配（或预测）一个</span><strong><span>数字</span></strong><span>，表示这个点属于哪个簇</span></p><h4><a name="351-k均值聚类-k-means-clustering" class="md-header-anchor"></a><span>3.5.1 k均值聚类 k-Means clustering </span></h4><ul><li><p><span>试图找到代表数据特定区域的</span><strong><span>簇中心</span></strong><span>（cluster center）</span></p></li><li><p><strong><span>算法步骤</span></strong><span>（迭代）：将每个数据点分配给</span><strong><span>最近</span></strong><span>的</span><strong><span>簇中心</span></strong><span>，然后将每个</span><strong><span>簇中心设置为</span></strong><span>所分配的所有数据点的</span><strong><span>平均值</span></strong></p></li><li><p><span>将KMeans应用于模拟数据集make_blobs:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">make_blobs</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">KMeans</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 生成模拟的二维数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_blobs</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 构建聚类模型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span> = <span class="cm-variable">KMeans</span>(<span class="cm-variable">n_clusters</span>=<span class="cm-number">3</span>) <span class="cm-comment"># 寻找的簇个数为3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 159px;"></div></div></div></pre></li><li><p><span>算法运行期间，为X中的每个训练数据点分配一个簇标签（label）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Cluster memberships:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">kmeans</span>.<span class="cm-property">labels_</span>))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cluster</span> <span class="cm-variable">memberships</span>:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> &nbsp;<span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">1</span> <span class="cm-number">2</span> <span class="cm-number">2</span> <span class="cm-number">0</span> <span class="cm-number">0</span> <span class="cm-number">1</span> <span class="cm-number">0</span> <span class="cm-number">1</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre></li><li><p><span>可以用</span><strong><span>predict</span></strong><span>方法为</span><strong><span>新数据点分配簇标签</span></strong><span>。预测时会将最近的簇中心分配给每个新数据点，但现有模型不会改变。对训练集运行predict会返回与labels_</span><strong><span>相同</span></strong><span>的结果</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">kmeans</span>.<span class="cm-property">predict</span>(<span class="cm-variable">X</span>))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cluster</span> <span class="cm-variable">memberships</span>:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre></li></ul><h5><a name="1k均值的失败案例" class="md-header-anchor"></a><span>1.k均值的失败案例</span></h5><ul><li><p><span>每个簇都是凸形（convex）,因此，k均值只能找到</span><strong><span>相对简单</span></strong><span>的</span><strong><span>形状</span></strong></p></li><li><p><span>k均值还假设</span><strong><span>所有方向</span></strong><span>对每个簇都</span><strong><span>同等重要</span></strong></p><p><span>例如：(k均值无法识别非球形簇以及复杂形状(two_moons)的簇)</span></p><p><img src=".\ML_COURSE\kmeans failed.png" style="zoom:50%;" /></p></li></ul><p><img src=".\ML_COURSE\kmeans failed in complex.png" style="zoom:50%;" /></p><h5><a name="2矢量量化或者将k均值看作分解" class="md-header-anchor"></a><span>2.矢量量化，或者将k均值看作分解</span></h5><ul><li><p><span>虽然k均值是一种聚类算法，但在k均值和分解方法（比如之前讨论过的PCA和NMF）之间存在一些有趣的</span><strong><span>相似</span></strong><span>之处</span></p></li><li><p><strong><span>PCA</span></strong><span>试图找到数据中</span><strong><span>方差最大的方向</span></strong><span>，而</span><strong><span>NMF</span></strong><span>试图找到</span><strong><span>累加的分量</span></strong><span>，这通常对应于数据的“极值”或“部分”。两种方法都试图将数据点表示为一些</span><strong><span>分量之和</span></strong></p></li><li><p><span>与之相反，k均值则尝试利用</span><strong><span>簇中心</span></strong><span>来表示每个数据点（可以将其看作</span><strong><span>仅用一个分量</span></strong><span>来表示每个数据点，该分量由簇中心给出）</span></p></li><li><p><span>这种观点将k均值看作是一种</span><strong><span>分解方法</span></strong><span>，其中</span><strong><span>每个点用单一分量来表示</span></strong><span>，这种观点被称为</span><strong><span>矢量量化（vector quantization）</span></strong></p></li><li><p><span>并排</span><strong><span>比较</span></strong><span>PCA、NMF和k均值：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X_people</span>, <span class="cm-variable">y_people</span>, <span class="cm-variable">stratify</span>=<span class="cm-variable">y_people</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nmf</span> = <span class="cm-variable">NMF</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">100</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>) <span class="cm-comment"># NMF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nmf</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span> = <span class="cm-variable">PCA</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">100</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>) <span class="cm-comment"># PCA</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span> = <span class="cm-variable">KMeans</span>(<span class="cm-variable">n_clusters</span>=<span class="cm-number">100</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>) <span class="cm-comment"># KMeans</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 181px;"></div><div class="CodeMirror-gutters" style="display: none; height: 181px;"></div></div></div></pre><p><strong><span>重建（reconstructed）:</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_reconstructed_pca</span> = <span class="cm-variable">pca</span>.<span class="cm-property">inverse_transform</span>(<span class="cm-variable">pca</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_reconstructed_kmeans</span> = <span class="cm-variable">kmeans</span>.<span class="cm-property">cluster_centers_</span>[<span class="cm-variable">kmeans</span>.<span class="cm-property">predict</span>(<span class="cm-variable">X_test</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_reconstructed_nmf</span> = <span class="cm-variable">np</span>.<span class="cm-property">dot</span>(<span class="cm-variable">nmf</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>), <span class="cm-variable">nmf</span>.<span class="cm-property">components_</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre></li><li><p><span>//TODO...</span></p></li><li><p><span>利用k均值的许多簇来表示复杂数据集中的变化</span></p><p><img src=".\ML_COURSE\many k-means clusters cover variation.png" style="zoom:50%;" /></p></li><li><p><span>将</span><strong><span>到每个簇中心的距离</span></strong><span>作为</span><strong><span>特征</span></strong><span>，还可以得到一种</span><strong><span>表现力(expressive)更强</span></strong><span>的数据表示。可以利用kmeans的</span><strong><span>transform</span></strong><span>方法来完成这一点</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">distance_features</span> = <span class="cm-variable">kmeans</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Distance feature shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">distance_features</span>.<span class="cm-property">shape</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Distance features:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">distance_features</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Distance</span> <span class="cm-variable">feature</span> <span class="cm-variable">shape</span>: (<span class="cm-number">200</span>, <span class="cm-number">10</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Distance</span> <span class="cm-variable">features</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre></li><li><p><span>k均值是非常流行的聚类算法，因为它不仅</span><strong><span>相对容易理解和实现</span></strong><span>，而且</span><strong><span>运行速度</span></strong><span>也</span><strong><span>相对较</span></strong></p><p><strong><span>快</span></strong><span>。k均值可以轻松扩展到</span><strong><span>大型数据集</span></strong><span>，scikit-learn甚至在MiniBatchKMeans类中包含了</span></p><p><span>一种更具可扩展性的变体，可以处理非常大的数据集</span></p><p><strong><span>缺点：</span></strong></p></li><li><p><span>k均值的</span><strong><span>缺点</span></strong><span>(drawback)之一在于，它依赖于随机初始化，也就是说，算法的输出依赖于</span><strong><span>随机种子</span></strong><span>。</span></p><p><strong><span>默认</span></strong><span>情况下，scikit-learn用</span><strong><span>10种</span></strong><span>不同的随机初始化将算法运行</span><strong><span>10次</span></strong><span>，并返回最佳结果</span></p></li><li><p><span>k均值还有一个</span><strong><span>缺点</span></strong><span>，就是对</span><strong><span>簇形状</span></strong><span>的假设的</span><strong><span>约束性较强</span></strong><span>，而且还要求</span><strong><span>指定</span></strong><span>所要寻找的</span><strong><span>簇的个数</span></strong><span>（在现实世界的应用中可能并不知道这个数字）</span></p></li></ul><h4><a name="352-凝聚聚类-agglomerative-clustering" class="md-header-anchor"></a><span>3.5.2 凝聚聚类 Agglomerative Clustering </span></h4><ul><li><p><span>凝聚聚类（agglomerative clustering）指的是许多基于</span><strong><span>相同原则</span></strong><span>构建的聚类算法，这一原则是：算法首先声明每个点是</span><strong><span>自己的簇</span></strong><span>，然后</span><strong><span>合并</span></strong><span>两个</span><strong><span>最相似</span></strong><span>的簇，直到满足某种</span><strong><span>停止准则</span></strong><span>为止</span></p></li><li><p><strong><span>scikit-learn</span></strong><span>中实现的停止准则是</span><strong><span>簇的个数</span></strong><span>，因此相似的簇被合并，直到仅剩下指定个数的簇</span></p></li><li><p><span>还有一些</span><strong><span>链接（linkage）准则</span></strong><span>，规定</span><strong><span>如何度量</span></strong><span>“最相似的簇”。这种度量总是定义在两个现有的簇之间</span></p></li><li><p><span>scikit-learn中实现了以下三种选项：</span></p><ul><li><p><strong><span>ward</span></strong></p><p><strong><span>默认</span></strong><span>选项。ward挑选两个簇来合并，使得所有簇中的</span><strong><span>方差增加最小</span></strong><span>。这通常会得到</span><strong><span>大小差不多相等</span></strong><span>的簇</span></p></li><li><p><strong><span>average</span></strong></p><p><span>average链接将簇中所有点之间</span><strong><span>平均距离最小</span></strong><span>的两个簇合并</span></p></li><li><p><strong><span>complete</span></strong></p><p><span>complete链接（也称为最大链接）将簇</span><strong><span>中点之间最大距离最小</span></strong><span>的两个簇合并</span></p></li><li><p><span>ward适用于</span><strong><span>大多数</span></strong><span>数据集，如果簇中的成员个数</span><strong><span>非常不同</span></strong><span>（比如其中一个比其他所有都</span><strong><span>大得多</span></strong><span>），那么average或complete可能效果</span><strong><span>更好</span></strong></p></li></ul></li><li><p><span>//TODO 寻找三个簇（二维数据集+简单三簇）...</span></p></li><li><p><span>由于算法的工作原理，凝聚算法</span><strong><span>不能对新数据点</span></strong><span>做出</span><strong><span>预测</span></strong><span>。因此AgglomerativeClustering</span><strong><span>没有predict</span></strong><span>方</span></p><p><span>法。为了构造模型并得到</span><strong><span>训练集上簇的成员关系</span></strong><span>，可以改用</span><strong><span>fit_predict</span></strong><span>方法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">AgglomerativeClustering</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_blobs</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">agg</span> = <span class="cm-variable">AgglomerativeClustering</span>(<span class="cm-variable">n_clusters</span>=<span class="cm-number">3</span>) <span class="cm-comment"># n_clusters=3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">assignment</span> = <span class="cm-variable">agg</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>虽然凝聚聚类的scikit-learn实现需要你指定希望算法找到的</span><strong><span>簇的个数</span></strong><span>，但凝聚聚类方法为</span><strong><span>选择正确的个数</span></strong><span>提供了一些帮助，将在下面讨论</span></p></li></ul><h5><a name="1层次聚类与树状图-hierarchical-clustering-and-dendrograms" class="md-header-anchor"></a><span>1.层次聚类与树状图 Hierarchical clustering and dendrograms</span></h5><ul><li><p><span>凝聚聚类生成了所谓的层次聚类（hierarchical clustering）。聚类过程</span><strong><span>迭代</span></strong><span>进行，每个点都从一个单点簇变为属于最终的某个簇，但它依赖于数据的二维性质，因此不能用于具有两个以上特征的数据集</span></p></li><li><p><span>另一个将层次聚类</span><strong><span>可视化的工具</span></strong><span>，叫作</span><strong><span>树状图</span></strong><span>（dendrogram），它可以处理多维数据集</span></p></li><li><p><span>目前scikit-learn没有绘制树状图的功能。但你可以利用</span><strong><span>SciPy</span></strong><span>轻松生成树状图</span></p></li><li><p><span>SciPy提供了一个函数，接受数据</span><strong><span>数组X</span></strong><span>并计算出一个</span><strong><span>链接数组</span></strong><span>（linkage array），它对层次聚类的</span><strong><span>相似度</span></strong><span>进行</span><strong><span>编码</span></strong><span>。然后我们可以将这个链接数组提供给</span><strong><span>scipy</span></strong><span>的</span><strong><span>dendrogram函数</span></strong><span>来绘制树状图：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 从SciPy中导入dendrogram函数和ward聚类函数</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">scipy</span>.<span class="cm-property">cluster</span>.<span class="cm-property">hierarchy</span> <span class="cm-keyword">import</span> <span class="cm-variable">dendrogram</span>, <span class="cm-variable">ward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_blobs</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>, <span class="cm-variable">n_samples</span>=<span class="cm-number">12</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 将ward聚类应用于数据数组X</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># SciPy的ward函数返回一个数组，指定执行凝聚聚类时跨越的距离</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkage_array</span> = <span class="cm-variable">ward</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 现在为包含簇之间距离的linkage_array绘制树状图</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dendrogram</span>(<span class="cm-variable">linkage_array</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 在树中标记划分成两个簇或三个簇的位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span> = <span class="cm-variable">plt</span>.<span class="cm-property">gca</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">bounds</span> = <span class="cm-variable">ax</span>.<span class="cm-property">get_xbound</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">plot</span>(<span class="cm-variable">bounds</span>, [<span class="cm-number">7.25</span>, <span class="cm-number">7.25</span>], <span class="cm-string">'--'</span>, <span class="cm-variable">c</span>=<span class="cm-string">'k'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">plot</span>(<span class="cm-variable">bounds</span>, [<span class="cm-number">4</span>, <span class="cm-number">4</span>], <span class="cm-string">'--'</span>, <span class="cm-variable">c</span>=<span class="cm-string">'k'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre><p><img src=".\ML_COURSE\three clusters dendrogram.png" style="zoom:50%;" /></p><ul><li><p><span>树状图在底部显示</span><strong><span>数据点</span></strong><span>（编号从0到11）。然后以这些点（表示</span><strong><span>单点簇</span></strong><span>）作为</span><strong><span>叶节点</span></strong><span>绘</span></p><p><span>制一棵树，每</span><strong><span>合并两个簇</span></strong><span>就添加一个</span><strong><span>新的父节点</span></strong></p></li><li><p><span>从下往上看，数据点1和4首先被合并，以此类推...</span></p></li><li><p><span>在这张树状图中，</span><strong><span>最长的分支</span></strong><span>是用标记为“three clusters”（三个簇）的虚线表示的三条线</span></p></li><li><p><span>不幸的是，凝聚聚类仍然</span><strong><span>无法</span></strong><span>分离像two_moons数据集这样复杂的形状，下一个算法DBSCAN可以解决这个问题</span></p></li></ul></li></ul><h4><a name="353-dbscan-density-based-spatial-clustering-of-applications-with-noise" class="md-header-anchor"></a><span>3.5.3 DBSCAN density-based spatial clustering of applications with noise</span></h4><p><strong><span>具有噪声的基于密度的空间聚类应用</span></strong></p><ul><li><p><span>DBSCAN的</span><strong><span>主要优点</span></strong><span>是它</span><strong><span>不需要</span></strong><span>用户先验地</span><strong><span>设置簇的个数</span></strong><span>，可以划分具有</span><strong><span>复杂形状</span></strong><span>的簇，还可以</span><strong><span>找出不属于</span></strong><span>任何簇的</span><strong><span>点</span></strong><span>。DBSCAN比凝聚聚类和k均值</span><strong><span>稍慢</span></strong><span>，但仍可以扩展到</span><strong><span>相对较大的数据集</span></strong></p></li><li><p><span>DBSCAN的原理是识别特征空间的密集（dense）区域。DBSCAN背后的思想是，簇形成数据的密集区域，并由相对较空的区域分隔开</span></p></li><li><p><span>在密集区域内的点被称为</span><strong><span>核心样本</span></strong><span>（</span><strong><span>core sample</span></strong><span>，或核心点），它们的定义如下</span></p></li><li><p><span>DBSCAN 有两个参数：</span><strong><span>min_samples</span></strong><span>和</span><strong><span>eps</span></strong><span>。如果在距一个给定数据点</span><strong><span>eps的距离内至少有min_samples个数据点</span></strong><span>，那么这个数据点就是</span><strong><span>核心样本</span></strong><span>。DBSCAN将</span><strong><span>彼此距离小于eps</span></strong><span>的</span><strong><span>核心样本</span></strong><span>放到</span><strong><span>同一个簇</span></strong><span>中</span></p></li><li><p><span>算法首先任意选取一个点，然后找到到这个点的距离小于等于eps的所有的点。如果距起始点的距离在eps之内的数据点个数</span><strong><span>小于min_samples</span></strong><span>，那么这个点被标记为</span><strong><span>噪声（noise）</span></strong><span>，也就是说它</span><strong><span>不属于任何簇</span></strong></p></li><li><p><span>如果距离在eps之内的数据点个数</span><strong><span>大于min_samples</span></strong><span>（至少有min_samples个），则这个点被标记为核心样本，并被分配一个新的簇标签。然后访问该点的所有</span><strong><span>邻居</span></strong><span>（在距离eps以内），依照之前的条件以此类推分配标签，簇逐渐增大，直到在簇的eps距离内没有更多的核心样本为止</span></p><p><span>算法迭代示意图：</span></p><p><img src=".\ML_COURSE\dbscan iterations.png" style="zoom:50%;" /></p></li><li><p><span>最后，一共有三种类型的点：</span><strong><span>核心点</span></strong><span>、与核心点的距离在eps之内的点（叫作</span><strong><span>边界点</span></strong><span>，boundary point）和</span><strong><span>噪声</span></strong></p></li><li><p><span>边界点可能与</span><strong><span>不止一个簇的核心样本相邻</span></strong><span>。因此，边界点所属的簇依赖于数据点的访问顺序。一般来说只有很少的边界点，这种对访问顺序的轻度依赖并不重要</span></p></li><li><p><span>与凝聚聚类类似，DBSCAN也</span><strong><span>不允许</span></strong><span>对</span><strong><span>新的测试数据</span></strong><span>进行</span><strong><span>预测</span></strong><span>，所以将使用</span><strong><span>fit_predict</span></strong><span>方法来执行聚类并返回簇标签</span></p><p><span>将DBSCAN应用于</span><strong><span>演示凝聚聚类的模拟数据集</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">DBSCAN</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_blobs</span>(<span class="cm-variable">random_state</span>=<span class="cm-number">0</span>, <span class="cm-variable">n_samples</span>=<span class="cm-number">12</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dbscan</span> = <span class="cm-variable">DBSCAN</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clusters</span> = <span class="cm-variable">dbscan</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Cluster memberships:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">clusters</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cluster</span> <span class="cm-variable">memberships</span>:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[<span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-number">1</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>所有数据点都被分配了标签-1，这代表</span><strong><span>噪声</span></strong><span>，这是eps和min_samples默认参数设置的结果(</span><strong><span>not tuned</span></strong><span> for small toy datasets)</span></p></li><li><p><span>min_samples和eps取不同值时的簇分类如下所示，及其可视化结果见图</span></p><p><img src=".\ML_COURSE\min samples eps.png" style="zoom:50%;" /></p><p><img src=".\ML_COURSE\min samples eps illustration.png" style="zoom: 67%;" /></p><p><span>在这张图中，属于簇的点是实心的，而噪声点则显示为空心的。核心样本显示为较大的标</span></p><p><span>记，而边界点则显示为较小的标记</span></p></li><li><p><span>将</span><strong><span>eps</span></strong><span>设置得</span><strong><span>非常小</span></strong><span>，意味着没有点是核心样本，可能会导致所有点都被标记为</span><strong><span>噪声</span></strong><span>。将eps设置得</span></p><p><strong><span>非常大</span></strong><span>，可能会导致所有点形成</span><strong><span>单个簇</span></strong></p></li><li><p><span>设置</span><strong><span>min_samples</span></strong><span>主要是为了判断稀疏区域内的点被标记为异常值还是形成自己的簇，如</span></p><p><span>果</span><strong><span>增大min_samples</span></strong><span>，任何一个包含少于min_samples个样本的簇现在将被标记为</span><strong><span>噪声</span></strong><span>。因</span></p><p><span>此，</span><strong><span>min_samples决定簇的最小尺寸</span></strong></p></li><li><p><span>虽然DBSCAN不需要显式地设置簇的个数，但设置eps可以</span><strong><span>隐式</span></strong><span>地控制找到的</span><strong><span>簇的个数</span></strong></p></li><li><p><span>使用StandardScaler或MinMaxScaler对数据进行</span><strong><span>缩放</span></strong><span>之后，有时会更容易找到eps的较好</span></p><p><span>取值，因为能确保所有特征具有相似的</span><strong><span>范围</span></strong></p></li><li><p><span>在</span><strong><span>two_moons数据集</span></strong><span>上运行DBSCAN的结果，利用默认设置：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>, <span class="cm-variable">y</span> = <span class="cm-variable">make_moons</span>(<span class="cm-variable">n_samples</span>=<span class="cm-number">200</span>, <span class="cm-variable">noise</span>=<span class="cm-number">0.05</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 将数据缩放成平均值为0、方差为1 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">StandardScaler</span>()<span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dbscan</span> = <span class="cm-variable">DBSCAN</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clusters</span> = <span class="cm-variable">dbscan</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">X_scaled</span>) <span class="cm-comment"># fit_predict</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 绘制簇分配</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">scatter</span>(<span class="cm-variable">X_scaled</span>[:, <span class="cm-number">0</span>], <span class="cm-variable">X_scaled</span>[:, <span class="cm-number">1</span>], <span class="cm-variable">c</span>=<span class="cm-variable">clusters</span>, <span class="cm-variable">cmap</span>=<span class="cm-variable">mglearn</span>.<span class="cm-property">cm2</span>, <span class="cm-variable">s</span>=<span class="cm-number">60</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">"Feature 0"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">"Feature 1"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 272px;"></div><div class="CodeMirror-gutters" style="display: none; height: 272px;"></div></div></div></pre><p><span>													</span><span>利用默认值eps=0.5的DBSCAN找到的簇分配</span></p><p><img src=".\ML_COURSE\eps two_moons.png" style="zoom:50%;" /></p><p>&nbsp;</p></li></ul><h4><a name="354-聚类算法的对比与评估" class="md-header-anchor"></a><span>3.5.4 聚类算法的对比与评估</span></h4><h5><a name="1用真实值评估聚类-evaluating-clustering-with-ground-truth" class="md-header-anchor"></a><span>1.用真实值评估聚类 Evaluating clustering with ground truth</span></h5><ul><li><p><strong><span>调整rand指数</span></strong><span> （adjusted rand index，</span><strong><span>ARI</span></strong><span>）和</span><strong><span>归一化互信息</span></strong><span>（normalized mutual information，</span><strong><span>NMI</span></strong><span>）</span></p></li><li><p><span>使用ARI来比较k均值、凝聚聚类和DBSCAN算法</span></p></li><li><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">metrics</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">adjusted_rand_score</span> <span class="cm-comment"># adjusted_rand_score</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-property">ax</span>.<span class="cm-property">set_title</span>(<span class="cm-string">"{} - ARI: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">algorithm</span>.<span class="cm-property">__class__</span>.<span class="cm-property">__name__</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">adjusted_rand_score</span>(<span class="cm-variable">y</span>, <span class="cm-variable">clusters</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><p><span>				</span><span>利用监督ARI分数在two_moons数据集上比较</span><strong><span>随机分配</span></strong><span>、</span><strong><span>k均值</span></strong><span>、</span><strong><span>凝聚聚类</span></strong><span>和</span><strong><span>DBSCAN</span></strong></p><p><img src=".\ML_COURSE\ARI compare.png" style="zoom: 80%;" /></p><p><span>用这种方式评估聚类时，一个常见的</span><strong><span>错误</span></strong><span>是使用accuracy_score而不是adjusted_rand_score、normalized_mutual_info_score或其他聚类指标</span></p></li></ul><h5><a name="2在没有真实值的情况下评估聚类-evaluating-clustering-without-ground-truth" class="md-header-anchor"></a><span>2.在没有真实值的情况下评估聚类 Evaluating clustering without ground truth</span></h5><ul><li><p><strong><span>轮廓系数（silhouette coeffcient）</span></strong><span>轮廓分数计算一个簇的紧致度，其值越大越好，最高分数为1。虽然 </span></p><p><span>紧致的簇很好，但紧致度不允许复杂的形状</span></p></li><li><p><span>利用轮廓分数在two_moons数据集上比较k均值、凝聚聚类和DBSCAN：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">metrics</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">silhouette_score</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-property">silhouette_score</span>(<span class="cm-variable">X_scaled</span>, <span class="cm-variable">clusters</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><img src=".\ML_COURSE\silhouette_score.png" style="zoom:80%;" /></p><p><span>k均值的轮廓分数最高，尽管我们可能更喜欢DBSCAN的结果。对于评估聚类，稍好的策略是使用</span><strong><span>基于鲁棒性</span></strong><span>的（robustness-based）聚类指标</span></p></li></ul><h4><a name="355-聚类方法小结--summary-of-clustering-methods" class="md-header-anchor"></a><span>3.5.5 聚类方法小结  Summary of Clustering Methods</span></h4><p><span>k均值和凝聚聚类允许你指定想要的簇的数量，而DBSCAN允许你用eps参数定义接近程度，从而间接影响簇的大小。三种方法都可以用于</span><strong><span>大型</span></strong><span>的</span><strong><span>现实世界</span></strong><span>数据集，都相对容易理解，也都可以聚类成多个簇</span></p><h4><a name="估计器接口小结" class="md-header-anchor"></a><span>估计器接口小结</span></h4><p><img src=".\ML_COURSE\估计器接口小结1.png" style="zoom: 67%;" /></p><p><img src=".\ML_COURSE\估计器接口小结2.png" style="zoom:67%;" /></p><h4><a name="test1-课堂练习" class="md-header-anchor"></a><span>Test1 课堂练习</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">将knn算法运用于iris数据集，比较MinMaxScaler前后的score变化</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">将KMeans算法运用于iris数据集</span>(<span class="cm-variable">n_clusters</span>=<span class="cm-number">3</span>),<span class="cm-variable">利用样本真实类别评价聚类结果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">/</span><span class="cm-variable">ML</span><span class="cm-operator">/</span><span class="cm-variable">test1</span><span class="cm-operator">/</span><span class="cm-variable">class_test1</span>.<span class="cm-property">ipynb</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#1 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_iris</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">train_test_split</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">neighbors</span> <span class="cm-keyword">import</span> <span class="cm-variable">KNeighborsClassifier</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">iris</span> = <span class="cm-variable">load_iris</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">iris</span>.<span class="cm-property">data</span>, <span class="cm-variable">iris</span>.<span class="cm-property">target</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">knn</span> = <span class="cm-variable">KNeighborsClassifier</span>(<span class="cm-variable">n_neighbors</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">knn</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test set accuracy: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">knn</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(2)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">MinMaxScaler</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">MinMaxScaler</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_train</span>)<span class="cm-comment"># MinMax缩放</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_test_scaled</span> = <span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">X_test</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># svm.fit(X_train_scaled, y_train)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">knn</span> = <span class="cm-variable">KNeighborsClassifier</span>(<span class="cm-variable">n_neighbors</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">knn</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train_scaled</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Scaled test set accuracy: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">knn</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test_scaled</span>, <span class="cm-variable">y_test</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># X_train scaled</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum before scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>))) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum before scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum after scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>))) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum after scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_train_scaled</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># X_test scaled (range changed not in [0,1])</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum before scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_test</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>))) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum before scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_test</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature minimum after scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_test_scaled</span>.<span class="cm-property">min</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>))) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"per-feature maximum after scaling:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X_test_scaled</span>.<span class="cm-property">max</span>(<span class="cm-variable">axis</span>=<span class="cm-number">0</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_iris</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">KMeans</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">iris</span>=<span class="cm-variable">load_iris</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> = <span class="cm-variable">iris</span>.<span class="cm-property">get</span>(<span class="cm-string">'data'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span> = <span class="cm-variable">KMeans</span>(<span class="cm-variable">n_clusters</span>=<span class="cm-number">3</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kmeans</span>.<span class="cm-property">fit</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">label_pred</span>=<span class="cm-variable">kmeans</span>.<span class="cm-property">labels_</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">label_pred</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#print(kmeans.predict(data))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">a</span>=<span class="cm-variable">label_pred</span>.<span class="cm-property">tolist</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">b</span>=<span class="cm-variable">a</span>[:<span class="cm-number">50</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c</span>=<span class="cm-variable">a</span>[<span class="cm-number">50</span>:<span class="cm-number">100</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">d</span>=<span class="cm-variable">a</span>[<span class="cm-number">100</span>:<span class="cm-number">150</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">b1</span>=<span class="cm-builtin">max</span>(<span class="cm-builtin">max</span>(<span class="cm-variable">b</span>.<span class="cm-property">count</span>(<span class="cm-number">0</span>),<span class="cm-variable">b</span>.<span class="cm-property">count</span>(<span class="cm-number">1</span>)),<span class="cm-variable">b</span>.<span class="cm-property">count</span>(<span class="cm-number">2</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">b1</span>) <span class="cm-comment"># b</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c1</span>=<span class="cm-builtin">max</span>(<span class="cm-builtin">max</span>(<span class="cm-variable">c</span>.<span class="cm-property">count</span>(<span class="cm-number">0</span>),<span class="cm-variable">c</span>.<span class="cm-property">count</span>(<span class="cm-number">1</span>)),<span class="cm-variable">c</span>.<span class="cm-property">count</span>(<span class="cm-number">2</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">c1</span>) <span class="cm-comment"># c</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">d1</span>=<span class="cm-builtin">max</span>(<span class="cm-builtin">max</span>(<span class="cm-variable">d</span>.<span class="cm-property">count</span>(<span class="cm-number">0</span>),<span class="cm-variable">d</span>.<span class="cm-property">count</span>(<span class="cm-number">1</span>)),<span class="cm-variable">d</span>.<span class="cm-property">count</span>(<span class="cm-number">2</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">d1</span>) <span class="cm-comment"># d</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"accuracy: {:.2f}"</span>.<span class="cm-property">format</span>((<span class="cm-variable">b1</span><span class="cm-operator">+</span><span class="cm-variable">c1</span><span class="cm-operator">+</span><span class="cm-variable">d1</span>)<span class="cm-operator">/</span><span class="cm-number">150</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1519px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1519px;"></div></div></div></pre><p>&nbsp;</p><h4><a name="test2-课堂练习" class="md-header-anchor"></a><span>Test2 课堂练习</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">使用凝聚聚类算法对鸢尾花数据集进行聚类，并画出对应的树状图。</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">使用DBSCAN算法对原始鸢尾花数据集进行聚类，查看聚类结果。将鸢尾花数据集进行最小最大缩放后，再次使用DBSCAN算法聚类，并查看聚类结果。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3.</span><span class="cm-variable">使用凝聚聚类算法对鸢尾花数据集进行聚类，分别使用adjusted_rand_score和silhouette_score指标对聚类结果进行评价。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">/</span><span class="cm-variable">ML</span><span class="cm-operator">/</span><span class="cm-variable">test2</span><span class="cm-operator">/</span><span class="cm-variable">class_test2</span>.<span class="cm-property">ipynb</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">AgglomerativeClustering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">scipy</span>.<span class="cm-property">cluster</span>.<span class="cm-property">hierarchy</span> <span class="cm-keyword">import</span> <span class="cm-variable">dendrogram</span>,<span class="cm-variable">ward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_iris</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">train_test_split</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">iris</span>=<span class="cm-variable">load_iris</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span>=<span class="cm-variable">iris</span>.<span class="cm-property">data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">target</span>=<span class="cm-variable">iris</span>.<span class="cm-property">target</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkage_array</span> = <span class="cm-variable">ward</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dendrogram</span>(<span class="cm-variable">linkage_array</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span> = <span class="cm-variable">plt</span>.<span class="cm-property">gca</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">bounds</span> = <span class="cm-variable">ax</span>.<span class="cm-property">get_xbound</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">plot</span>(<span class="cm-variable">bounds</span>, [<span class="cm-number">7.25</span>, <span class="cm-number">7.25</span>], <span class="cm-string">'--'</span>, <span class="cm-variable">c</span>=<span class="cm-string">'k'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">plot</span>(<span class="cm-variable">bounds</span>, [<span class="cm-number">4</span>, <span class="cm-number">4</span>], <span class="cm-string">'--'</span>, <span class="cm-variable">c</span>=<span class="cm-string">'k'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">text</span>(<span class="cm-variable">bounds</span>[<span class="cm-number">1</span>], <span class="cm-number">7.25</span>, <span class="cm-string">' two clusters'</span>, <span class="cm-variable">va</span>=<span class="cm-string">'center'</span>, <span class="cm-variable">fontdict</span>={<span class="cm-string">'size'</span>: <span class="cm-number">15</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ax</span>.<span class="cm-property">text</span>(<span class="cm-variable">bounds</span>[<span class="cm-number">1</span>], <span class="cm-number">4</span>, <span class="cm-string">' three clusters'</span>, <span class="cm-variable">va</span>=<span class="cm-string">'center'</span>, <span class="cm-variable">fontdict</span>={<span class="cm-string">'size'</span>: <span class="cm-number">15</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">"Sample index"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">"Cluster distance"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">DBSCAN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dbscan</span> = <span class="cm-variable">DBSCAN</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clusters</span> = <span class="cm-variable">dbscan</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Cluster memberships:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">clusters</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(2)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">MinMaxScaler</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">train_test_split</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span> = <span class="cm-variable">MinMaxScaler</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scaler</span>.<span class="cm-property">fit</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_scaled</span>=<span class="cm-variable">scaler</span>.<span class="cm-property">transform</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># dbscan = DBSCAN(eps=0.4, min_samples=5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dbscan</span>=<span class="cm-variable">DBSCAN</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clusters</span> = <span class="cm-variable">dbscan</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">X_scaled</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Cluster memberships:\n{}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">clusters</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">metrics</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">adjusted_rand_score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">metrics</span>.<span class="cm-property">cluster</span> <span class="cm-keyword">import</span> <span class="cm-variable">silhouette_score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">agg</span> = <span class="cm-variable">AgglomerativeClustering</span>(<span class="cm-variable">linkage</span>=<span class="cm-string">'average'</span>,<span class="cm-variable">n_clusters</span>=<span class="cm-number">3</span>)<span class="cm-comment">#linkage='ward' </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">assignment</span> = <span class="cm-variable">agg</span>.<span class="cm-property">fit_predict</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">adjusted_rand_score</span>(<span class="cm-variable">assignment</span>,<span class="cm-variable">target</span>)) <span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">silhouette_score</span>(<span class="cm-variable">data</span>,<span class="cm-variable">assignment</span>)) <span class="cm-comment">#</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1247px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1247px;"></div></div></div></pre><p>&nbsp;</p><h4><a name="test3-课堂练习" class="md-header-anchor"></a><span>Test3 课堂练习</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">mglearn</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_iris</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> = <span class="cm-variable">load_iris</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">y</span> = <span class="cm-variable">data</span>.<span class="cm-property">target</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> = <span class="cm-variable">data</span>.<span class="cm-property">data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">decomposition</span> <span class="cm-keyword">import</span> <span class="cm-variable">PCA</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pca</span> = <span class="cm-variable">PCA</span>(<span class="cm-variable">n_components</span>=<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">reduced_x</span>=<span class="cm-variable">pca</span>.<span class="cm-property">fit_transform</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mglearn</span>.<span class="cm-property">discrete_scatter</span>(<span class="cm-variable">reduced_x</span>[:,<span class="cm-number">0</span>],<span class="cm-variable">reduced_x</span>[:,<span class="cm-number">1</span>],<span class="cm-variable">y</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">-----------------------------------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">tree</span> <span class="cm-keyword">import</span> <span class="cm-variable">DecisionTreeClassifier</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">datasets</span> <span class="cm-keyword">import</span> <span class="cm-variable">load_iris</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">train_test_split</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">iris</span> = <span class="cm-variable">load_iris</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">iris</span>.<span class="cm-property">data</span>, <span class="cm-variable">iris</span>.<span class="cm-property">target</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">42</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span> = <span class="cm-variable">DecisionTreeClassifier</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tree</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>,<span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">tree</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">tree</span>.<span class="cm-property">feature_importances_</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">ensemble</span> <span class="cm-keyword">import</span> <span class="cm-variable">RandomForestClassifier</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span> = <span class="cm-variable">RandomForestClassifier</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">forest</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>,<span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">forest</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">forest</span>.<span class="cm-property">feature_importances_</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 748px;"></div><div class="CodeMirror-gutters" style="display: none; height: 748px;"></div></div></div></pre><p>&nbsp;</p><h2><a name="chapter4-representing-data-and-engineering-features-数据表示和特征工程" class="md-header-anchor"></a><span>Chapter4 Representing Data and Engineering Features 数据表示和特征工程 </span></h2><ul><li><p><span>分类特征（categorical feature）</span></p></li><li><p><span>离散特征（discrete feature）</span></p></li><li><p><span>对于某个特定应用来说，如何找到最佳数据表示，这个问题被称为</span><strong><span>特征工程</span></strong><span>（feature  </span></p><p><span>engineering）</span></p></li><li><p><span>adult数据集</span></p></li></ul><h4><a name="411-one-hot编码虚拟变量）one-hot-encoding-dummy-variables" class="md-header-anchor"></a><span>4.1.1 One-Hot编码（虚拟变量）One-Hot-Encoding (Dummy variables) </span></h4><ul><li><p><span>one-hot 编码（one-hot-encoding）或 N 取一编码（one-out-of-N encoding），也叫虚拟变量（dummy variable）</span></p></li><li><p><span>新特征取值为 0 和 1</span></p></li><li><p><span>pandas库</span></p></li><li><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">pandas</span> <span class="cm-keyword">as</span> <span class="cm-variable">pd</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">IPython</span>.<span class="cm-property">display</span> <span class="cm-keyword">import</span> <span class="cm-variable">display</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 文件中没有包含列名称的表头，因此我们传入header=None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 然后在"names"中显式地提供列名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> = <span class="cm-variable">pd</span>.<span class="cm-property">read_csv</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">"data/adult.data"</span>, <span class="cm-variable">header</span>=<span class="cm-keyword">None</span>, <span class="cm-variable">index_col</span>=<span class="cm-keyword">False</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">names</span>=[<span class="cm-string">'age'</span>, <span class="cm-string">'workclass'</span>, <span class="cm-string">'fnlwgt'</span>, <span class="cm-string">'education'</span>, <span class="cm-string">'education-num'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">'marital-status'</span>, <span class="cm-string">'occupation'</span>, <span class="cm-string">'relationship'</span>, <span class="cm-string">'race'</span>, <span class="cm-string">'gender'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">'capital-gain'</span>, <span class="cm-string">'capital-loss'</span>, <span class="cm-string">'hours-per-week'</span>, <span class="cm-string">'native-country'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">'income'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 为了便于说明，我们只选了其中几列</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> = <span class="cm-variable">data</span>[[<span class="cm-string">'age'</span>, <span class="cm-string">'workclass'</span>, <span class="cm-string">'education'</span>, <span class="cm-string">'gender'</span>, <span class="cm-string">'hours-per-week'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-string">'occupation'</span>, <span class="cm-string">'income'</span>]]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># IPython.display可以在Jupyter notebook中输出漂亮的格式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">display</span>(<span class="cm-variable">data</span>.<span class="cm-property">head</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 340px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></pre></li></ul><h5><a name="1检查字符串编码的分类数据--checking-string-encoded-categorical-data" class="md-header-anchor"></a><span>1.</span><strong><span>检查字符串编码的分类数据  Checking string-encoded categorical data</span></strong><span> </span></h5><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin">print</span>(<span class="cm-variable">data</span>.<span class="cm-property">gender</span>.<span class="cm-property">value_counts</span>())</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><span>get_dummies函数(自动变换所有具有对象类型（比如字符串）的列或所有分类的列)</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">In</span>[<span class="cm-number">4</span>]:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin cm-error">print</span>(<span class="cm-string">"Original features:\n"</span>, <span class="cm-builtin">list</span>(<span class="cm-variable">data</span>.<span class="cm-property">columns</span>), <span class="cm-string">"\n"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">data_dummies</span> = <span class="cm-variable">pd</span>.<span class="cm-property">get_dummies</span>(<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-builtin cm-error">print</span>(<span class="cm-string">"Features after get_dummies:\n"</span>, <span class="cm-builtin">list</span>(<span class="cm-variable">data_dummies</span>.<span class="cm-property">columns</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Out</span>[<span class="cm-number">4</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable cm-error">Original</span> <span class="cm-variable">features</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-null cm-error">[</span><span class="cm-string">'age'</span>, <span class="cm-string">'workclass'</span>, <span class="cm-string">'education'</span>, <span class="cm-string">'gender'</span>, <span class="cm-string">'hours-per-week'</span>, <span class="cm-string">'occupation'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-string">'income'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Features</span> <span class="cm-variable">after</span> <span class="cm-variable">get_dummies</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-null cm-error">[</span><span class="cm-string">'age'</span>, <span class="cm-string">'hours-per-week'</span>, <span class="cm-string">'workclass_ ?'</span>, <span class="cm-string">'workclass_ Federal-gov'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-string">'workclass_ Local-gov'</span>, <span class="cm-string">'workclass_ Never-worked'</span>, <span class="cm-string">'workclass_ Private'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-string">'occupation_ Farming-fishing'</span>, <span class="cm-string">'occupation_ Handlers-cleaners'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-string">'occupation_ Tech-support'</span>, <span class="cm-string">'occupation_ Transport-moving'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-string">'income_ &lt;=50K'</span>, <span class="cm-string">'income_ &gt;50K'</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 363px;"></div><div class="CodeMirror-gutters" style="display: none; height: 363px;"></div></div></div></pre><ul><li><p><strong><span>连续特征</span></strong><span> age 和 hours-per-week </span><strong><span>没有发生变化</span></strong></p></li><li><p><span>使用 values 属性将 data_dummies 数据框（DataFrame）转换为 </span><strong><span>NumPy 数组</span></strong><span>， </span></p><p><span>然后在其上训练一个机器学习模型。在训练模型之前，注意要把</span><strong><span>目标变量</span></strong><span>（现在被编码为两个 income 列）从数据中分离出来。将输出变量或输出变量的一些导出属性包含在特征表示中，这是构建监督机器学习模型时一个非常常见的</span><strong><span>错误</span></strong><span>。</span></p></li><li><p><span>提取包含特征的列，也就是从 age 到 occupation_ Transport-moving </span></p><p><span>的所有列。这一范围包含所有特征，但不包含目标：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">features</span> = <span class="cm-variable">data_dummies</span>.<span class="cm-property">ix</span>[:, <span class="cm-string">'age'</span>:<span class="cm-string">'occupation_ Transport-moving'</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 提取NumPy数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span> = <span class="cm-variable">features</span>.<span class="cm-property">values</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">y</span> = <span class="cm-variable">data_dummies</span>[<span class="cm-string">'income_ &gt;50K'</span>].<span class="cm-property">values</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"X.shape: {} y.shape: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">X</span>.<span class="cm-property">shape</span>, <span class="cm-variable">y</span>.<span class="cm-property">shape</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Out</span>[<span class="cm-number">6</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X</span>.<span class="cm-property">shape</span>: (<span class="cm-number">32561</span>, <span class="cm-number">44</span>) <span class="cm-variable">y</span>.<span class="cm-property">shape</span>: (<span class="cm-number">32561</span>,)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 159px;"></div></div></div></pre><p><span>现在数据的表示方式可以被 </span><strong><span>scikit-learn</span></strong><span> 处理</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">linear_model</span> <span class="cm-keyword">import</span> <span class="cm-variable">LogisticRegression</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-property">model_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">train_test_split</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">X_train</span>, <span class="cm-variable">X_test</span>, <span class="cm-variable">y_train</span>, <span class="cm-variable">y_test</span> = <span class="cm-variable">train_test_split</span>(<span class="cm-variable">X</span>, <span class="cm-variable">y</span>, <span class="cm-variable">random_state</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">logreg</span> = <span class="cm-variable">LogisticRegression</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">logreg</span>.<span class="cm-property">fit</span>(<span class="cm-variable">X_train</span>, <span class="cm-variable">y_train</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"Test score: {:.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">logreg</span>.<span class="cm-property">score</span>(<span class="cm-variable">X_test</span>, <span class="cm-variable">y_test</span>)))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Test</span> <span class="cm-variable">score</span>: <span class="cm-number">0.81</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li></ul><h4><a name="412-数字可以编码分类变量" class="md-header-anchor"></a><span>4.1.2 数字可以编码分类变量</span></h4><h4><a name="42-分箱离散化线性模型与树-binning-discretization-linear-models-and-trees" class="md-header-anchor"></a><span>4.2 分箱、离散化、线性模型与树 Binning, Discretization, Linear Models and Trees</span></h4><ul><li><p><span>决策树可以构建更为复杂的数据模型，但这强烈依赖于数据表示。有一种方法可以让线性模型在连续</span></p><p><span>数据上变得更加强大，就是使用特征分箱（binning，也叫离散化，即discretization）将其划分为多个特征</span></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div>
</body>
</html>